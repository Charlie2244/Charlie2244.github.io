
<!DOCTYPE html>
<html lang="zh-CN">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="who 动了我的奶酪">
    <title>react hooks 神三元项目解析 - who 动了我的奶酪</title>
    <meta name="author" content="花生">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/home/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"花生","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"articleBody":"\n吧啦吧啦&nbsp;&nbsp;&nbsp;&nbsp; 自从弄懂了神三元大神的作品《云音悦》，整个人神清气爽，飘飘欲仙~，本着学习应该共同进步的精神，我将三元项目的一个页面流程进行了一个细致的讲解。是的，你没有听错，是流程。我相信有很多人拿到一个开源项目希望能够弄懂，但是一个项目肯定是很大的，不知从何下手，每个组件与每个组件之间有着千丝万缕的联系，于是，想想还是算了吧。 &nbsp;&nbsp;&nbsp;&nbsp; 在这里我将从零开始搭建这个项目，一步一步的将项目的真面目露出来，需要说明的是，我在这里仅仅只是对三元项目的代码进行了 cv大战(粘贴复制)，当然cv不是说每个文件一次性全部复制，而是有选择性的将流程能够走通。\n&nbsp;&nbsp;&nbsp;&nbsp; 如下图就是我们要完成的一个页面，其他的页面也是类似，完成这个页面其实能说明很多问题了，这个页面有从后端请求数据，有redux管理数据，有轮播图。。。 不多说了，进入正题吧!\n\n技术栈\nreact \nstyled.components 使得css在js文件可以书写\nhooks  react新特性\nredux  状态管理\nimmutable  优化性能\nbetter-scroll  一个比较好的滚动下拉组件\nreact-router-config  将路由全部统一管理\n注意: 这些知识点你都要掌握(至少要了解他们是什么)，不然食起来可能会有点痛苦哦~\n\n## 项目目录结构\n\n\n\n \n目录\n\n\n\n\nsrc\n\napi 前后端数据接口 以及一些配置文件\n\napplication 页面组件以及每个组件的store\n\nassets 静态资源目录，主要放iconfonts以及全局样式\n\nbaseUI 功能性组件 如 加载组件 滚动条等\n\ncomponents 公共组件 如轮播图\n\nlayouts 涉及到路由,组件嵌套\n\nroutes  路由，使用react-router-config\n\nstore 全局 redux 仓库\n开始工作1. 配置路由src下创建 routes 文件夹 建index.js文件\n \nindex.js\n\nimport React, { lazy, Suspense } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport HomeLayout from \"../layouts/HomeLayout\";\nimport BlankLayout from \"../layouts/BlankLayout\";\n\n// 路由懒加载const SuspenseComponent = Component =&gt; props =&gt; {  return (\n&lt;Suspense fallback={null}&gt;\n  &lt;Component {...props}&gt;&lt;/Component&gt;\n&lt;/Suspense&gt;  )}// 组件懒加载const RecommendComponent = lazy(() =&gt; import(“../application/Recommend/“));\nexport default [  {\ncomponent: BlankLayout,\nroutes: [\n  {\n    path: &quot;/&quot;,\n    component: HomeLayout,\n    routes: [\n      {\n        path: &quot;/&quot;,\n        exact: true,\n        render: () =&gt; &lt;Redirect to={&quot;/recommend&quot;} /&gt;,\n      },\n      {\n        path: &quot;/recommend&quot;,\n        component:  SuspenseComponent(RecommendComponent),\n      },\n    ],\n  },\n],  },];\n\n\n\n\n这种配置路由的方式与之前普通的区别可能有点大，不了解的建议充个电(react-router-config) 在这里BlankLayout是全局组件，在它下面放置所有路由级别组件，HomeLayout下所有路由级别组件也都归HomeLayout管理，这里我们看到的只有recommend组件，这也就是逐级嵌套。所有的路由都放在这里统一管理，之前普通路由是哪个组件需要路由才到哪个组件下面写，管理不方便。\n2. 创建layouts文件夹建 BlankLayout.js 以及 HomeLayout.js &nbsp;&nbsp; BlankLayout.js下是全局组件，HomeLayout下放的是recommend singers,rank 三大组件，由于整个项目过多，这里我们只介绍recommend页面，当然，如果recommend页面会写了，那么其他页面其实都是类似的操作\n \nBlankLayout.js\n\n  import React from \"react\";\n  import { renderRoutes } from \"react-router-config\";\n  // 从我们刚刚配置的路由可知 这个组件是最外层组件 所有路由级别组件都在这\n  const Layout = ({ route }) => {renderRoutes(route.routes)};\n  export default Layout\n\n\n\n \nHomeLayout.js\n\n\n12345678910111213import React from \"react\";import &#123; renderRoutes &#125; from \"react-router-config\";function Home(props) &#123;  const &#123; route &#125; = props;  return (    &lt;div&gt;      &#123;/* 将HomeLayout的子组件都放到这里 */&#125;      &#123;renderRoutes(route.routes)&#125;    &lt;/div&gt;  )&#125;export default React.memo(Home);\n\n\n可以看到这样用到了 renderRoutes,根据 routes 里面的内容，HomeLayout 是 BlankLayout 子路由，并且在 BlankLayout 下面有子路由 recommend, 所以将renderRoutes放在 HomeLayout 下面。(route)\n\n3. 创建application目录创建Recommend子目录,Recomend下创建index.js\n\nindex.js\n\n   \n\n\n\n现在还不能运行，因为在app.js中没有导入路由(由于div会被编辑器吃掉😂，某些地方只能上图片)\n4. 来到App.js \nApp.js\n\n    123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145    import React from \"react\";    import routes from \"./routes/index.js\";    import &#123; renderRoutes &#125; from \"react-router-config\";    import &#123; HashRouter &#125; from \"react-router-dom\";    function App() &#123;      return (          &lt;HashRouter&gt;            &#123;renderRoutes(routes)&#125;          &lt;/HashRouter&gt;      );    &#125;    export default App;    ```\t&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;我们将 routes里面的文件导入到了renderRoutes,renderRoutes就可以根据routes里面的组件在其他组件下放入其他组件了(就问你绕不绕，此其他非彼其他🤔)。这个理解了其实用起来感觉会很方便。到这我们安装两个包```jsyarn add react-router-configyarn add react-router-dom```\t这个时候项目就可以运行起来了运行结果如下![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e34411e98093472aa5cb96792b861a35~tplv-k3u1fbpfcp-zoom-1.image)### 5. 配置 global-style.js 文件 以及全局样式src下创建 assets目录，创建该文件，该文件是通用样式文件(不要与全局样式混淆)，比如，该app的主题颜色(你懂的颜色)在许多地方都会用到&lt;details style=\"background:#d0edf5\"&gt;&lt;summary&gt;global-style.js&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;    ```js    const extendClick = () =&gt; &#123;      return `        position: relative;        &amp;:before&#123;          content: '';          position: absolute;          top: -10px; bottom: -10px; left: -10px; right: -10px;        &#125;;      `;    &#125;;    const noWrap = () =&gt; &#123;      return `        text-overflow: ellipsis;        overflow: hidden;        white-space: nowrap;      `;    &#125;;    const bgFull = () =&gt; &#123;      return `        background-position: 50%;        background-size: contain;        background-repeat: no-repeat;      `    &#125;;    export default &#123;      \"theme-color\": \"#d44439\", //今天有绿吗      \"theme-color-shadow\": \"rgba(212, 68, 57, .5)\",      \"font-color-light\": \"#f1f1f1\",      \"font-color-light-shadow\": \"rgba(241, 241, 241, 0.6)\",//略淡      \"font-color-desc\": \"#2E3030\",      \"font-color-desc-v2\": \"#bba8a8\", //略淡      \"font-size-ss\": \"10px\",      \"font-size-s\": \"12px\",      \"font-size-m\": \"14px\",      \"font-size-l\": \"16px\",      \"font-size-ll\": \"18px\",      \"border-color\": \"#e4e4e4\",      \"border-color-v2\": \"rgba(228, 228, 228, 0.1)\",      \"background-color\": \"#f2f3f4\",      \"background-color-shadow\": \"rgba(0, 0, 0, 0.3)\",      \"highlight-background-color\": \"#fff\",      \"official-red\": \"#E82001\",      extendClick,      noWrap,      bgFull    &#125;;    ```\t&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;全局样式，这个样式不仅仅在这里可以用到，其他的项目同样可以引入&lt;details style=\"background:#d0edf5\"&gt;&lt;summary&gt;style.js&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;    ```js    import &#123; createGlobalStyle &#125; from 'styled-components'    export const GlobalStyle = createGlobalStyle`        html, body, div, span, applet, object, iframe,        h1, h2, h3, h4, h5, h6, p, blockquote, pre,        a, abbr, acronym, address, big, cite, code,        del, dfn, em, img, ins, kbd, q, s, samp,        small, strike, strong, sub, sup, tt, var,        b, u, i, center,        dl, dt, dd, ol, ul, li,        fieldset, form, label, legend,        table, caption, tbody, tfoot, thead, tr, th, td,        article, aside, canvas, details, embed,         figure, figcaption, footer, header, hgroup,         menu, nav, output, ruby, section, summary,        time, mark, audio, video &#123;            margin: 0;            padding: 0;            border: 0;            font-size: 100%;            font: inherit;            vertical-align: baseline;        &#125;        /* HTML5 display-role reset for older browsers */        article, aside, details, figcaption, figure,         footer, header, hgroup, menu, nav, section &#123;            display: block;        &#125;        body &#123;            line-height: 1;        &#125;        html, body&#123;            background: #f2f3f4;;        &#125;        ol, ul &#123;            list-style: none;        &#125;        blockquote, q &#123;            quotes: none;        &#125;        blockquote:before, blockquote:after,        q:before, q:after &#123;            content: '';            content: none;        &#125;        table &#123;            border-collapse: collapse;            border-spacing: 0;        &#125;        a&#123;            text-decoration: none;            color: #fff;        &#125;    `\n\n\n\n\n6. 开始写头部这里我们将用到 比较新的知识styled.components以及需要iconfont , 来到HomeLayout下，\n\nHomeLayout.js\n\n   \n\n\n这里我们导入了HomeLayout.style.js(styled.componets)以及 &#xe65c;(iconfont)，未加iconfont类似于‘口’，因此我们需要创建它们。styled.components就类似于在js文件里面写样式，并且该容器的class会随机生成。从如下代码我们可以看到Top就是一个容器，它的子容器的样式也可以在这里写，然后导入上面的HomeLayout.js.\n7. 在同级目录下创建HomeLayout.style.js\nHomeLayout.style.js\n\n     1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283    import styled from \"styled-components\";    import style from \"../assets/global-style\";    export const Top = styled.div`      display: flex;      flex-direction: row;      justify-content: space-between;      padding: 5px 10px;      background: $&#123;style[\"theme-color\"]&#125;;      &amp; &gt; span &#123;        line-height: 40px;        color: #f1f1f1;        font-size: 20px;        &amp;.iconfont &#123;          font-size: 25px;        &#125;      &#125;    `    ```\t&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;将这段代码引入之后就可以看到效果了此时运行结果如下![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/db7f42236a704b67b688b32e12d05ba1~tplv-k3u1fbpfcp-zoom-1.image)因为还没有配置iconfont,所以是如上效果### 8. 配置iconfont可以到icontfont官网下载所需要的文件，放在assets目录下，目录如下![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be6982fc567b44fbb4bc65dd33c40730~tplv-k3u1fbpfcp-zoom-1.image)在全局App.js引入icontfont文件，加上这几行代码```jsimport &#123; IconStyle &#125; from \"./assets/iconfont/iconfont\";&lt;HashRouter&gt;   &lt;IconStyle&gt;&lt;/IconStyle&gt;   &#123;renderRoutes(routes)&#125;&lt;/HashRouter&gt;```\t运行效果如下，图标出来了![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e026c85b69742a0b092451a1c3ea771~tplv-k3u1fbpfcp-zoom-1.image)### 9. 接着在 HomeLayout.js 写布局在原来的的基础上加上如下代码&lt;Top&gt;下面写&lt;details style=\"background:#d0edf5\"&gt;&lt;summary&gt;HomeLayout.js&lt;/summary&gt;![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7903bf78b8da4471ac8759c6dc832ee1~tplv-k3u1fbpfcp-zoom-1.image)&lt;/details&gt;这里我们用NavLink指向了三个路由地址，我们目前只做recommend上面引入了 &lt;Tab&gt;&lt;TabItem&gt;,在HomeLayout.style.js写&lt;details style=\"background:#d0edf5\"&gt;&lt;summary&gt;HomeLayout.style.js&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;    ```js    export const Tab = styled.div`      height: 44px;      display: flex;      flex-direction: row;      justify-content: space-around;      background: $&#123;style[\"theme-color\"]&#125;;      a &#123;        flex: 1;        padding: 2px 0;        font-size: 14px;        color: #e4e4e4;        &amp;.selected &#123;          span &#123;            padding: 3px 0;            font-weight: 700;            color: #f1f1f1;            border-bottom: 2px solid #f1f1f1;          &#125;        &#125;      &#125;    `;    export const TabItem = styled.div`      height: 100%;      display: flex;      flex-direction: row;      justify-content: center;      align-items: center;    `;\n\n\n\n页面结果如下\n10. 来到了难点重点部分。前面的都是一些基础的不需要从后端获取数据就可以完成的，但是接下来的内容轮播图，以及列表都是需要从后端接口请求数据渲染到页面。数据拿到了也需要人来管理，那么谁呢，就是你又爱又恨的redux。接下来首先得准备好接口数据src下创建api文件夹，在该文件夹下配置config.js文件， 该文件一般是用来配置默认后端请求接口路径\n\nconfig.js\n\n    123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200    import axios from \"axios\";    export const baseUrl = \"http://neteasecloudmusicapi.zhaoboy.com\";    // 创建一个axios的实例及拦截器配置    const axiosInstance = axios.create(&#123;      baseURL: baseUrl    &#125;);    // 响应拦截器，在获取响应之前处理数据    axiosInstance.interceptors.response.use(      res =&gt; res.data,      err =&gt; &#123;        console.log(err, \"网络错误\");      &#125;    );    export &#123; axiosInstance &#125;;    ```\t&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;### 11. 同路径api下创建request.js该文件用来封装 请求接口，通过调用该函数可以请求数据```jsimport &#123; axiosInstance &#125; from \"./config\";export const getBannerRequest = () =&gt; &#123;  return axiosInstance.get(\"/banner\");&#125;;```\t### 12. 创建redux 仓库需要说明的是，神三元项目中每个对应的路由组件都有一个store,然后将所有的store(该store中没有store文件，一个项目只应该有一个仓库)全部引入到最外面的store，这样写的理由是逻辑清晰。如果不这样写很多action放到一起，很多reducer放到一起，文件数量可能会较大，头都大了。&lt;br/&gt;那么用redux怎么管理数据呢？简单说就是dispatch(action)向store请求数据，store又找reducer,reducer对请求的数据进行一定的操作，存到store,在组件中connect一下，再通过props获取数据![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ebdeb84be27e4f5aa2cbae6373e178e2~tplv-k3u1fbpfcp-zoom-1.image)我们在Recommend下创建store文件夹，分别创建     &lt;code style=\"color:red;\"&gt;constants.js&lt;/code&gt;&lt;code style=\"color:red;\"&gt;actionCreators.js&lt;/code&gt;&lt;code style=\"color:red;\"&gt;reducer.js&lt;/code&gt;&lt;code style=\"color:red;\"&gt;index.js&lt;/code&gt;#### 12.1 constants.js该文件只有一行代码，作用是区分不同的actions ```jsexport const CHANGE_BANNER = 'home/recommend/CHANGE_BANNER';```\t#### 12.2 actionCreators.js 该文件中有 changeBannerList 用来改变状态，也就是传进来什么数据就修改成什么数据，但是为了支持异步，我们需要通过下面一个getBannerList来获取数据&lt;details style=\"background:#d0edf5\"&gt; &lt;summary&gt;actionCreators.js&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;     ```js    import * as actionTypes from './constants';    import &#123; fromJS &#125; from 'immutable';    import &#123; getBannerRequest &#125; from '../../../api/request';    export const changeBannerList = (data) =&gt; (&#123;      type: actionTypes.CHANGE_BANNER,      data: fromJS(data)    &#125;);    // 获取 轮播图数据    export const getBannerList = () =&gt; &#123;      return (dispatch) =&gt; &#123;        getBannerRequest().then(data =&gt; &#123;          const action = changeBannerList(data.banners);          dispatch(action);        &#125;).catch(() =&gt; &#123;          console.log(\"轮播图数据传输错误\");        &#125;)       &#125;    &#125;;    ```\t&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;注意，我们在这里使用了immutable,以后的文件会大量用到immutable,简单介绍下作用: 使用旧数据创建新数据时可以保证新数据不变，并且创建新数据的过程中使用了结构共享，如下图所示![](https://user-gold-cdn.xitu.io/2018/4/4/1628e77dc419816b?imageslim)在上面的代码中我们导入getBannerRequest的请求，getBannerList 返回的是一个方法，我们需要在store导入redux-thunk包,这是后面写到的。&lt;br/&gt;#### 12.3 reducer.jsreducer.js 首先初始化bannerList的数据，然后switch一顿狂操作&lt;details style=\"background:#d0edf5\"&gt; &lt;summary&gt;reducer.js&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;    ```js    import * as actionTypes from './constants';    import &#123; fromJS &#125; from 'immutable';    const defaultState = fromJS(&#123;      bannerList: [],    &#125;)    export default (state = defaultState, action) =&gt; &#123;      switch(action.type) &#123;        case actionTypes.CHANGE_BANNER:          return state.set('bannerList', action.data);        default:          return state;      &#125;    &#125;    ```\t&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;#### 12.4 index.js```jsimport reducer from './reducer'import * as actionCreators from './actionCreators'import * as constants from './constants'export &#123; reducer, actionCreators, constants &#125;;```\t将三个文件整合，并导出以上是Recommend 里面的store,(再次说明: 里面的store是没有仓库的，统一放到外面的仓库管理)，我们需要创建 外面最大的store### 13. 在src 创建 store文件夹(最外面的仓库)store 下创建 reducer.js 集合所有reducer, index.js 仓库reducer.js```jsimport &#123; combineReducers &#125; from \"redux-immutable\";import &#123; reducer as recommendReducer &#125; from \"../application/Recommend/store/index\";export default combineReducers(&#123;  recommend: recommendReducer,&#125;);```\tindex.js, 这里我们安装了 redux-thunk,支持action返回方法```jsimport &#123; createStore, compose, applyMiddleware &#125; from \"redux\";import thunk from \"redux-thunk\";import reducer from \"./reducer\";const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;const store = createStore(reducer, composeEnhancers(applyMiddleware(thunk)));export default store;```\t14. 在App.js 引入store,使之成为全局仓库现在App.js文件长这样&lt;details style=\"background:#d0edf5\"&gt; &lt;summary&gt;代码&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;    ```js    import React from \"react\";    import routes from \"./routes/index.js\";    import &#123; renderRoutes &#125; from \"react-router-config\";    import &#123; HashRouter &#125; from \"react-router-dom\";    import &#123; IconStyle &#125; from \"./assets/iconfont/iconfont\";    import &#123; Provider &#125; from \"react-redux\";    import store from \"./store/index\";    function App() &#123;      return (        &lt;Provider store=&#123;store&#125;&gt;          &lt;HashRouter&gt;            &lt;IconStyle&gt;&lt;/IconStyle&gt;            &#123;renderRoutes(routes)&#125;          &lt;/HashRouter&gt;        &lt;/Provider&gt;      );    &#125;    export default App;    ```\t&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;需要导入一个Provider，使得全局都可以使用store里面的数据到这里我们终于把Recommend的数据管理给搞定了，下载必要的包yarn add axios redux react-reudx immutable redux-immutable redux-thunk (可能不全)接下里就是如何将数据渲染到页面了。### 15. 来到HomeLayout的子组件Recommend下的 index.js 中首先我们先通过connect拿到数据&lt;details style=\"background:#d0edf5\"&gt; &lt;summary&gt;index.js&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b9db461c6ae4473ac4e8b4bafef023e~tplv-k3u1fbpfcp-zoom-1.image)&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;connect 之后怎么拿数据呢？ 通过props可以获取数据，接下来我们来写如何通过props获取数据&lt;details style=\"background:#d0edf5\"&gt; &lt;summary&gt;index.js&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;```js    function Recommend(props) &#123;      const &#123; bannerList&#125; = props;      const &#123; getBannerDataDispatch &#125; = props;      useEffect(() =&gt; &#123;        if(!bannerList.size)&#123;          getBannerDataDispatch();          console.log(bannerList);        &#125;      &#125;, []);      return (        &lt;div&gt;          Recommend        &lt;/div&gt;      )    &#125;\n\n\n\n\n只要connect之后，我们就可以通过props拿到数据了，props之后解构刚刚上面的bannerList数据和getBannerDataDispatch方法，调用该方法之后就可以获取数据，所以我们把它放到useEffect,中，判断bannerList是否为空，不用每次执行都请求一次数据。打印之后我们可以看到如下结果数据拿到了，现在要做轮播图，因为轮播图可能多个地方都会用到，所以我们将它放到components目录下\n16. 创建slider在src下创建components文件夹，接着创建slider文件夹，在里面创建 index.js和style.js\nstyle.js, 这是给swiper加的样式，引入了Global-style里面的主题颜色\n \nstyle.js\n\n    123456789101112131415161718192021222324252627282930313233343536import styled from 'styled-components';import style from '../../assets/global-style';export const SliderContainer = styled.div`  position: relative;  box-sizing: border-box;  width: 100%;  height: 100%;  margin: auto;  background: white;  .before&#123;    position: absolute;    top: -300px;    height: 400px;    width: 100%;    background: $&#123;style[\"theme-color\"]&#125;;    z-index: 1;  &#125;  .slider-container&#123;    position: relative;    width: 98%;    height: 160px;    overflow: hidden;    margin: auto;    border-radius: 6px;    .slider-nav&#123;      position: absolute;      display: block;      width: 100%;      height: 100%;    &#125;    .swiper-pagination-bullet-active&#123;      background: $&#123;style[\"theme-color\"]&#125;;    &#125;  &#125;`\n\n\nindex.js\n \n代码\n\n    1234567891011121314151617181920212223242526272829303132333435363738394041424344import React, &#123; useEffect, useState &#125; from 'react';import \"swiper/swiper-bundle.min.css\"; //这里引用的方式已经发生了变化import Swiper from \"swiper\";import &#123; SliderContainer &#125; from './style';function Slider(props) &#123;  const [sliderSwiper, setSliderSwiper] = useState(null);  const &#123; bannerList &#125; = props;  useEffect(() =&gt; &#123;    if(bannerList.length &amp;&amp; !sliderSwiper)&#123;      let sliderSwiper = new Swiper(\".slider-container\", &#123;        loop: true,        autoplay: &#123;          delay: 3000,          disableOnInteraction: false,        &#125;,        pagination: &#123;el:'.swiper-pagination'&#125;,      &#125;);      setSliderSwiper(sliderSwiper);    &#125;  &#125;, [bannerList.length, sliderSwiper])  return (    &lt;SliderContainer&gt;       &lt;div className=\"before\"&gt;&lt;/div&gt;       &lt;div className=\"slider-container\"&gt;       &lt;div className=\"swiper-wrapper\"&gt;         &#123;           bannerList.map(slider =&gt; &#123;             return (              &lt;div className=\"swiper-slide\" key=&#123;slider.imageUrl&#125;&gt;                 &lt;div className=\"slider-nav\"&gt;                 &lt;img src=&#123;slider.imageUrl&#125; width=\"100%\" height=\"100%\" alt=\"推荐\" /&gt;                 &lt;/div&gt;                &lt;/div&gt;             )           &#125;)         &#125;       &lt;/div&gt;       &lt;div className=\"swiper-pagination\"&gt;&lt;/div&gt;       &lt;/div&gt;    &lt;/SliderContainer&gt;  )&#125;export default React.memo(Slider);\n\n\n\n这里主要是使用了swiper api, 具体用法可以看swiper官网有详细介绍\n17. 导入sliderswiper 写完了之后，来到，recommend 下的index.js, 首先为index.js写个style.js\n \nstyle.js\n\n    123456789import styled from 'styled-components';export const Content = styled.div`    position: fixed;    top: 94px;    left: 0;    bottom: $&#123;props =&gt; props.play &gt; 0?\"60px\": 0&#125;;    width: 100%;`\n\n\n\n在index.js中导入Slider\n123456789import &#123; Content &#125; from \"./style\";import Slider from \"../../components/slider/\"; const bannerListJS = bannerList ? bannerList.toJS() : [];  return (    &lt;Content &gt;      &lt;div&gt;&lt;Slider bannerList=&#123;bannerListJS&#125;&gt;&lt;/Slider&gt;&lt;/div&gt;    &lt;/Content&gt;  );&#125;\n在 index.js加上上面这几句代码之后就可以看到效果了,但是你会发现header被覆盖了，这里其实是 Slider组件里面的before搞的鬼， 如果要改过来也很简单，在它的父容器加个overflow:hidden就可以解决问题，但是现在因为我们要做滚动(需要上下可以滚动)，滚动会做slider的父容器，也会有overflow:hidden,所以这里就先不处理。但是我们发现这个轮播图是不能滚动的，因为我们现在用的swiper 是swiper6最新版本，具体的可以看官网如何使用\n18. loading组件讲解scroll组件又会牵扯到 loading 组件(加载)和 debounce函数(防抖)，所以得先建loading组件和防抖函数baseUI文件下分别创建loading和loading-v2文件夹\nloading中的文件\n \nindex.js\n\n    1234567891011121314151617181920212223242526272829303132333435363738import React from 'react';import styled, &#123; keyframes &#125; from 'styled-components';import style from '../../assets/global-style';const loading = keyframes`  0%, 100% &#123;    transform: scale(0.0);  &#125;  50% &#123;    transform: scale(1.0);  &#125;`const LoadingWrapper = styled.div`    &gt;div &#123;      position: absolute;      top: 0; left: 0; right: 0; bottom: 0;      margin: auto;      width: 60px;      height: 60px;      opacity: 0.6;      border-radius: 50%;      background-color: $&#123;style[\"theme-color\"]&#125;;      animation: $&#123;loading&#125; 1.4s infinite ease-in;    &#125;    &gt;div:nth-child(2) &#123;      animation-delay: -0.7s;    &#125;`function Loading()  &#123;  return (    &lt;LoadingWrapper&gt;      &lt;div&gt;&lt;/div&gt;      &lt;div&gt;&lt;/div&gt;    &lt;/LoadingWrapper&gt;  );&#125;export default React.memo(Loading);\n\n\nloading-v2中的文件\n \nindex.js\n\n    123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354import React from 'react';import styled, &#123;keyframes&#125; from 'styled-components';import style from '../../assets/global-style'const dance = keyframes`    0%, 40%, 100%&#123;      transform: scaleY(0.4);      transform-origin: center 100%;    &#125;    20%&#123;      transform: scaleY(1);    &#125;`const Loading = styled.div`    height: 10px;    width: 100%;    margin: auto;    text-align: center;    font-size: 10px;    &gt;div&#123;      display: inline-block;      background-color: $&#123;style[\"theme-color\"]&#125;;      height: 100%;      width: 1px;      margin-right:2px;      animation: $&#123;dance&#125; 1s infinite;    &#125;    &gt;div:nth-child(2) &#123;      animation-delay: -0.4s;    &#125;    &gt;div:nth-child(3) &#123;      animation-delay: -0.6s;    &#125;    &gt;div:nth-child(4) &#123;      animation-delay: -0.5s;    &#125;    &gt;div:nth-child(5) &#123;      animation-delay: -0.2s;    &#125; `function LoadingV2() &#123;  return (    &lt;Loading&gt;      &lt;div&gt;&lt;/div&gt;      &lt;div&gt;&lt;/div&gt;      &lt;div&gt;&lt;/div&gt;      &lt;div&gt;&lt;/div&gt;      &lt;div&gt;&lt;/div&gt;      &lt;span&gt;拼命加载中...&lt;/span&gt;    &lt;/Loading&gt;  );&#125;export default React.memo(LoadingV2);\n\n\n\n这两个文件都是用animation做的加载动画，具体就不介绍了，篇幅过长~\n19. debounce 函数防抖函数建在 api 的 utils.js 中什么是防抖\n举个栗子：有个scroll事件，滚动会不停触发回滚动事件，从而调用绑定的回调函数，我们希望当我们停止滚动的时，才触发一次回调，这时可以使用函数防抖。\n \n代码\n\n12345678910111213const debounce = (func, delay) =&gt; &#123;  let timer;  return function (...args) &#123;    if(timer) &#123;      clearTimeout(timer);    &#125;    timer = setTimeout(() =&gt; &#123;      func.apply(this, args);      clearTimeout(timer);    &#125;, delay);  &#125;;&#125;;export &#123; debounce &#125;\n\n\n这是三元写的原生js防抖函数，防抖原理就是第一次触发某个函数，在规定时间内如果再次触发就会重新计时。\n\n20. scroll好了，预备工作完成了，就可以写了，这里再说明一下，我现在是尽可能的帮助大家梳理如何能够看懂一个比较好的项目，实现可以自己动手实践\n \nindex.js\n\n    123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180import React, &#123;  forwardRef,  useState,  useEffect,  useRef,  useImperativeHandle,  useMemo,&#125; from \"react\";import PropTypes from \"prop-types\";import BScroll from \"better-scroll\";import styled from \"styled-components\";import &#123; debounce &#125; from \"../../api/utils\";import Loading from '../loading/index';import Loading2 from '../loading-v2/index';const ScrollContainer = styled.div`  width: 100%;  height: 100%;  overflow: hidden;`;const PullUpLoading = styled.div`  position: absolute;  left: 0;  right: 0;  bottom: 5px;  width: 60px;  height: 60px;  margin: auto;  z-index: 100;`;export const PullDownLoading = styled.div`  position: absolute;  left: 0;  right: 0;  top: 0px;  height: 30px;  margin: auto;  z-index: 100;`;const Scroll = forwardRef((props, ref) =&gt; &#123;  const [bScroll, setBScroll] = useState();  const scrollContaninerRef = useRef();  const &#123;    direction,    click,    refresh,    pullUpLoading,    pullDownLoading,    bounceTop,    bounceBottom,  &#125; = props;  const &#123; pullUp, pullDown, onScroll &#125; = props;  let pullUpDebounce = useMemo(() =&gt; &#123;    return debounce(pullUp, 500);  &#125;, [pullUp]);  let pullDownDebounce = useMemo(() =&gt; &#123;    return debounce(pullDown, 500);  &#125;, [pullDown]);  useEffect(() =&gt; &#123;    const scroll = new BScroll(scrollContaninerRef.current, &#123;      scrollX: direction === \"horizental\",      scrollY: direction === \"vertical\",      probeType: 3,      click: click,      bounce: &#123;        top: bounceTop,        bottom: bounceBottom,      &#125;,    &#125;);    setBScroll(scroll);    return () =&gt; &#123;      setBScroll(null);    &#125;;    // eslint-disable-next-line  &#125;, []);  useEffect(() =&gt; &#123;    if (!bScroll || !onScroll) return;    bScroll.on(\"scroll\", onScroll);    return () =&gt; &#123;      bScroll.off(\"scroll\", onScroll);    &#125;;  &#125;, [onScroll, bScroll]);  useEffect(() =&gt; &#123;    if (!bScroll || !pullUp) return;    const handlePullUp = () =&gt; &#123;      //判断是否滑动到了底部      if (bScroll.y &lt;= bScroll.maxScrollY + 100) &#123;        pullUpDebounce();      &#125;    &#125;;    bScroll.on(\"scrollEnd\", handlePullUp);    return () =&gt; &#123;      bScroll.off(\"scrollEnd\", handlePullUp);    &#125;;  &#125;, [pullUp, pullUpDebounce, bScroll]);  useEffect(() =&gt; &#123;    if (!bScroll || !pullDown) return;    const handlePullDown = (pos) =&gt; &#123;      //判断用户的下拉动作      if (pos.y &gt; 50) &#123;        pullDownDebounce();      &#125;    &#125;;    bScroll.on(\"touchEnd\", handlePullDown);    return () =&gt; &#123;      bScroll.off(\"touchEnd\", handlePullDown);    &#125;;  &#125;, [pullDown, pullDownDebounce, bScroll]);  useEffect(() =&gt; &#123;    if (refresh &amp;&amp; bScroll) &#123;      bScroll.refresh();    &#125;  &#125;);  useImperativeHandle(ref, () =&gt; (&#123;    refresh() &#123;      if (bScroll) &#123;        bScroll.refresh();        bScroll.scrollTo(0, 0);      &#125;    &#125;,    getBScroll() &#123;      if (bScroll) &#123;        return bScroll;      &#125;    &#125;,  &#125;));  const PullUpdisplayStyle = pullUpLoading    ? &#123; display: \"\" &#125;    : &#123; display: \"none\" &#125;;  const PullDowndisplayStyle = pullDownLoading    ? &#123; display: \"\" &#125;    : &#123; display: \"none\" &#125;;  return (    &lt;ScrollContainer ref=&#123;scrollContaninerRef&#125;&gt;      &#123;props.children&#125;      &#123;/* 滑到底部加载动画 */&#125;      &lt;PullUpLoading style=&#123;PullUpdisplayStyle&#125;&gt;        &lt;Loading&gt;&lt;/Loading&gt;      &lt;/PullUpLoading&gt;      &#123;/* 顶部下拉刷新动画 */&#125;      &lt;PullDownLoading style=&#123;PullDowndisplayStyle&#125;&gt;        &lt;Loading2&gt;&lt;/Loading2&gt;      &lt;/PullDownLoading&gt;    &lt;/ScrollContainer&gt;  );&#125;);Scroll.defaultProps = &#123;  direction: \"vertical\",  click: true,  refresh: true,  onScroll: null,  pullUpLoading: false,  pullDownLoading: false,  pullUp: null,  pullDown: null,  bounceTop: true,  bounceBottom: true,&#125;;Scroll.propTypes = &#123;  direction: PropTypes.oneOf([\"vertical\", \"horizental\"]),  refresh: PropTypes.bool,  onScroll: PropTypes.func,  pullUp: PropTypes.func,  pullDown: PropTypes.func,  pullUpLoading: PropTypes.bool,  pullDownLoading: PropTypes.bool,  bounceTop: PropTypes.bool, //是否支持向上吸顶  bounceBottom: PropTypes.bool, //是否支持向下吸顶&#125;;export default Scroll;\n\n\n\n这里用到的是better-scroll,同样的，因为这里用到了better-scroll，一讲可能就是一篇长篇文章。\n21. 完成轮播图和scroll上面的操作都完成了之后，终于要完成轮播和滚动了。\n来到recommend下index.js,只要导入scroll然后slider用scroll包裹起来就好了\n1234567import Scroll from '../../baseUI/scroll/index';&lt;Scroll className=\"list\" onScroll=&#123;forceCheck&#125;&gt;  &lt;div&gt;    &lt;Slider bannerList=&#123;bannerListJS&#125;&gt;&lt;/Slider&gt;      &lt;RecommendList recommendList=&#123;recommendListJS&#125;&gt;&lt;/RecommendList&gt;  &lt;/div&gt;&lt;/Scroll&gt;\n现在的效果图如下\n22. 列表数据apirequest.js下增加一条请求 列表数据的方法getRecommendListRequest\n1234567import &#123; axiosInstance &#125; from \"./config\";export const getBannerRequest = () =&gt; &#123;  return axiosInstance.get(\"/banner\");&#125;;export const getRecommendListRequest = () =&gt; &#123;  return axiosInstance.get(\"/personalized\");&#125;;\n23. 列表 redux接下来轻车熟路，又是像之前写 轮播图 redux一样 写 列表的 redux还是原来的 recommend store下的文件夹constants.js,增加一个常量,用于请求列表数据\n12export const CHANGE_BANNER = 'home/recommend/CHANGE_BANNER';export const CHANGE_RECOMMEND_LIST = 'home/recommend/RECOMMEND_LIST';\n\nactionCreators.js, 请求列表数据的changeRecommendList，可以异步的getRecommendList\n \nactionCreators.js\n\n    12345678910111213export const changeRecommendList = (data) =&gt; (&#123;  type: actionTypes.CHANGE_RECOMMEND_LIST,  data: fromJS(data)&#125;);export const getRecommendList = () =&gt; &#123;  return (dispatch) =&gt; &#123;    getRecommendListRequest().then(data =&gt; &#123;      dispatch(changeRecommendList(data.result));    &#125;).catch(() =&gt; &#123;      console.log(\"推荐歌单数据传输错误\");    &#125;);  &#125;&#125;;\n\n\n\nreducer.js，增加了另外一个初始化recommenList,以及一个case\n \nreducer.js\n\n    1234567891011121314151617import * as actionTypes from \"./constants\";import &#123; fromJS &#125; from \"immutable\";const defaultState = fromJS(&#123;  bannerList: [],  recommendList: [],&#125;);export default (state = defaultState, action) =&gt; &#123;  switch (action.type) &#123;    case actionTypes.CHANGE_BANNER:      return state.set(\"bannerList\", action.data);    case actionTypes.CHANGE_RECOMMEND_LIST:      return state.set(\"recommendList\", action.data);    default:      return state;  &#125;&#125;;\n\n\n\n24 . 收工经历了刀山火海，海枯石烂，来到了最后一步渲染recommendList\nrecommend 下 index.js, 这里面首先在mapStateToProps和 mapDispatchToProps加上相应的数据，props解构state和action方法，传给RecommendList组件(突然发现这里还有个组件😂)不过这个组件没有什么别的操作，仅仅只是拿到recommend给的数据然后渲染，这个代码就不贴了，三元github上有完整的项目代码\n \nindex.js\n\n    12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758import React, &#123; useEffect &#125; from \"react\";import &#123; connect &#125; from \"react-redux\";import * as actionTypes from \"./store/actionCreators\";import Slider from \"../../components/slider/\";import &#123; Content &#125; from \"./style\";import &#123; forceCheck &#125; from 'react-lazyload';import Scroll from '../../baseUI/scroll/index';import RecommendList from '../../components/list/';function Recommend(props) &#123;  const &#123; bannerList, recommendList &#125; = props;  const &#123; getBannerDataDispatch, getRecommendListDataDispatch &#125; = props;  useEffect(() =&gt; &#123;    if (!bannerList.size) &#123;      getBannerDataDispatch();    &#125;    if(!recommendList.size)&#123;      getRecommendListDataDispatch();    &#125;    // eslint-disable-next-line  &#125;, []);  const bannerListJS = bannerList ? bannerList.toJS() : [];  const recommendListJS = recommendList ? recommendList.toJS() :[];  return (    &lt;Content&gt;       &lt;Scroll className=\"list\" onScroll=&#123;forceCheck&#125;&gt;      &lt;div&gt;        &lt;Slider bannerList=&#123;bannerListJS&#125;&gt;&lt;/Slider&gt;        &lt;RecommendList recommendList=&#123;recommendListJS&#125;&gt;&lt;/RecommendList&gt;      &lt;/div&gt;      &lt;/Scroll&gt;    &lt;/Content&gt;  );&#125;// 映射Redux全局的state到组件的props上// recommend bannerList  是对象路径，在recommend.recommendListconst mapStateToProps = (state) =&gt; (&#123;  bannerList: state.getIn([\"recommend\", \"bannerList\"]),  recommendList: state.getIn(['recommend', 'recommendList']),&#125;);// 映射dispatch到props上const mapDispatchToProps = (dispatch) =&gt; &#123;  return &#123;    getBannerDataDispatch() &#123;      dispatch(actionTypes.getBannerList());    &#125;,    getRecommendListDataDispatch() &#123;      dispatch(actionTypes.getRecommendList());    &#125;,  &#125;;&#125;;// 将ui组件包装成容器组件export default connect(  mapStateToProps,  mapDispatchToProps)(React.memo(Recommend));\n\n\n最后我们就可以看到了这个效果，上下拉动的过程你会发现，纵享丝滑~\n\n\n25. 啦吧啦吧 相信看到最后的伙伴肯定有所收获，如果对源码感兴趣，这里有 三元项目的github源码,当然，如果想要深入学习这个项目，三元还有个 小册。同时，这里还有一个完整的项目演示 地址。\n 最后的最后，如果写的不好的地方，欢迎指正，有不清楚的地方也欢迎提问~\n","dateCreated":"2020-08-08T10:17:55+08:00","dateModified":"2020-08-16T09:40:58+08:00","datePublished":"2020-08-08T10:17:55+08:00","description":"\n吧啦吧啦&nbsp;&nbsp;&nbsp;&nbsp; 自从弄懂了神三元大神的作品《云音悦》，整个人神清气爽，飘飘欲仙~，本着学习应该共同进步的精神，我将三元项目的一个页面流程进行了一个细致的讲解。是的，你没有听错，是流程。我相信有很多人拿到一个开源项目希望能够弄懂，但是一个项目肯定是很大的，不知从何下手，每个组件与每个组件之间有着千丝万缕的联系，于是，想想还是算了吧。","headline":"react hooks 神三元项目解析","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"},"publisher":{"@type":"Organization","name":"花生","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"url":"http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/","keywords":"react"}</script>
    <meta name="description" content="吧啦吧啦&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 自从弄懂了神三元大神的作品《云音悦》，整个人神清气爽，飘飘欲仙~，本着学习应该共同进步的精神，我将三元项目的一个页面流程进行了一个细致的讲解。是的，你没有听错，是流程。我相信有很多人拿到一个开源项目希望能够弄懂，但是一个项目肯定是很大的，不知从何下手，每个组件与每个组件之间有着千丝万缕的联系，于是，想想还是算了吧。">
<meta property="og:type" content="blog">
<meta property="og:title" content="react hooks 神三元项目解析">
<meta property="og:url" content="http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/index.html">
<meta property="og:site_name" content="who 动了我的奶酪">
<meta property="og:description" content="吧啦吧啦&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 自从弄懂了神三元大神的作品《云音悦》，整个人神清气爽，飘飘欲仙~，本着学习应该共同进步的精神，我将三元项目的一个页面流程进行了一个细致的讲解。是的，你没有听错，是流程。我相信有很多人拿到一个开源项目希望能够弄懂，但是一个项目肯定是很大的，不知从何下手，每个组件与每个组件之间有着千丝万缕的联系，于是，想想还是算了吧。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb214c8eefa047f6ac59cafad10b8428~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe073fc746284b9889f0853fbce28886~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fed20cb2352429d8bac4cd82516ad11~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b38247c98864367a768f858f2241faa~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74e5ded5340f4cdf8a1cfb03661ad694~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b730a1c6138498bb924dc87781220f9~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cb087d9f61c41ad951e91be3ed40018~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f699119a0c646a48469b20202eebab5~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d93a6d672cf4759aaee455f57e1c4f7~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93b70da5c77640c8b0eb118573a5628b~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="article:published_time" content="2020-08-08T02:17:55.000Z">
<meta property="article:modified_time" content="2020-08-16T01:40:58.876Z">
<meta property="article:author" content="花生">
<meta property="article:tag" content="react">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb214c8eefa047f6ac59cafad10b8428~tplv-k3u1fbpfcp-zoom-1.image">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/home/assets/css/style-kerxambmqfx6cn93jfnfzoo7n3jozcgacgnrchnhxotafrvuep4nhynhvpmg.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/home/"
            aria-label=""
        >
            who 动了我的奶酪
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Öffne den Link: /home/#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/home/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/home/all-categories"
                            
                            rel="noopener"
                            title="Kategorien"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Kategorien</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/home/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/home/all-archives"
                            
                            rel="noopener"
                            title="Archiv"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archiv</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Suche"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Suche</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="Über"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Über</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://plus.google.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Google Plus"
                        >
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google Plus</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/home/mailto"
                            
                            rel="noopener"
                            title="E-Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">E-Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/home/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            react hooks 神三元项目解析
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-08-08T10:17:55+08:00">
	
		    08 8月 2020
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb214c8eefa047f6ac59cafad10b8428~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="吧啦吧啦"><a href="#吧啦吧啦" class="headerlink" title="吧啦吧啦"></a>吧啦吧啦</h2><p>&nbsp;&nbsp;&nbsp;&nbsp; 自从弄懂了神三元大神的作品《云音悦》，整个人神清气爽，飘飘欲仙~，本着学习应该共同进步的精神，我将三元项目的一个页面流程进行了一个细致的讲解。是的，你没有听错，是流程。我相信有很多人拿到一个开源项目希望能够弄懂，但是一个项目肯定是很大的，不知从何下手，每个组件与每个组件之间有着千丝万缕的联系，于是，想想还是算了吧。<br> <a id="more"></a><br>&nbsp;&nbsp;&nbsp;&nbsp; 在这里我将从零开始搭建这个项目，一步一步的将项目的真面目露出来，需要说明的是，我在这里仅仅只是对三元项目的代码进行了 cv大战(粘贴复制)，当然cv不是说每个文件一次性全部复制，而是有选择性的将流程能够走通。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; 如下图就是我们要完成的一个页面，其他的页面也是类似，完成这个页面其实能说明很多问题了，这个页面有从后端请求数据，有redux管理数据，有轮播图。。。 不多说了，进入正题吧!</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe073fc746284b9889f0853fbce28886~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><ul>
<li>react </li>
<li>styled.components 使得css在js文件可以书写</li>
<li>hooks  react新特性</li>
<li>redux  状态管理</li>
<li>immutable  优化性能</li>
<li>better-scroll  一个比较好的滚动下拉组件</li>
<li>react-router-config  将路由全部统一管理<blockquote style="color:black;background:#f8f8f8">
注意: 这些知识点你都要掌握(至少要了解他们是什么)，不然食起来可能会有点痛苦哦~
</blockquote>
## 项目目录结构

</li>
</ul>
<details style="background:#d0edf5"> 
<summary>目录</summary>

<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fed20cb2352429d8bac4cd82516ad11~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
</details>

<p>src</p>
<ul>
<li><p>api 前后端数据接口 以及一些配置文件</p>
</li>
<li><p>application 页面组件以及每个组件的store</p>
</li>
<li><p>assets 静态资源目录，主要放iconfonts以及全局样式</p>
</li>
<li><p>baseUI 功能性组件 如 加载组件 滚动条等</p>
</li>
<li><p>components 公共组件 如轮播图</p>
</li>
<li><p>layouts 涉及到路由,组件嵌套</p>
</li>
<li><p>routes  路由，使用react-router-config</p>
</li>
<li><p>store 全局 redux 仓库</p>
<h2 id="开始工作"><a href="#开始工作" class="headerlink" title="开始工作"></a>开始工作</h2><h3 id="1-配置路由"><a href="#1-配置路由" class="headerlink" title="1. 配置路由"></a>1. 配置路由</h3><p>src下创建 routes 文件夹 建index.js文件</p>
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code >
import React, { lazy, Suspense } from "react";
import { Redirect } from "react-router-dom";
import HomeLayout from "../layouts/HomeLayout";
import BlankLayout from "../layouts/BlankLayout";

<p>// 路由懒加载<br>const SuspenseComponent = Component =&gt; props =&gt; {<br>  return (</p>
<pre><code>&lt;Suspense fallback={null}&gt;
  &lt;Component {...props}&gt;&lt;/Component&gt;
&lt;/Suspense&gt;</code></pre><p>  )<br>}<br>// 组件懒加载<br>const RecommendComponent = lazy(() =&gt; import(“../application/Recommend/“));</p>
<p>export default [<br>  {</p>
<pre><code>component: BlankLayout,
routes: [
  {
    path: &quot;/&quot;,
    component: HomeLayout,
    routes: [
      {
        path: &quot;/&quot;,
        exact: true,
        render: () =&gt; &lt;Redirect to={&quot;/recommend&quot;} /&gt;,
      },
      {
        path: &quot;/recommend&quot;,
        component:  SuspenseComponent(RecommendComponent),
      },
    ],
  },
],</code></pre><p>  },<br>];<br></code></pre></p>
</details>

</li>
</ul>
<p>这种配置路由的方式与之前普通的区别可能有点大，不了解的建议充个电(react-router-config) <br/><br>在这里BlankLayout是全局组件，在它下面放置所有路由级别组件，HomeLayout下所有路由级别组件也都归HomeLayout管理，这里我们看到的只有recommend组件，这也就是<code style="color:red;">逐级嵌套</code>。所有的路由都放在这里统一管理，之前普通路由是哪个组件需要路由才到哪个组件下面写，管理不方便。</p>
<h3 id="2-创建layouts文件夹"><a href="#2-创建layouts文件夹" class="headerlink" title="2. 创建layouts文件夹"></a>2. 创建layouts文件夹</h3><p>建 BlankLayout.js 以及 HomeLayout.js<br/><br> &nbsp;&nbsp; BlankLayout.js下是全局组件，HomeLayout下放的是recommend singers,rank 三大组件，由于整个项目过多，这里我们只介绍recommend页面，当然，如果recommend页面会写了，那么其他页面其实都是类似的操作</p>
<details style="background:#d0edf5"> 
<summary>BlankLayout.js</summary>
<pre><code>
  import React from "react";
  import { renderRoutes } from "react-router-config";
  // 从我们刚刚配置的路由可知 这个组件是最外层组件 所有路由级别组件都在这
  const Layout = ({ route }) => <>{renderRoutes(route.routes)}</>;
  export default Layout
</code></pre>
</details>
<br/>
<details  style="background:#d0edf5"> 
<summary>HomeLayout.js</summary>

<pre><code>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; renderRoutes &#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; route &#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;<span class="comment">/* 将HomeLayout的子组件都放到这里 */</span>&#125;</span><br><span class="line">      &#123;renderRoutes(route.routes)&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default React.memo(Home);</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>
可以看到这样用到了 renderRoutes,根据 routes 里面的内容，HomeLayout 是 BlankLayout 子路由，并且在 BlankLayout 下面有子路由 recommend, 所以将renderRoutes放在 HomeLayout 下面。(route)

<h3 id="3-创建application目录"><a href="#3-创建application目录" class="headerlink" title="3. 创建application目录"></a>3. 创建application目录</h3><p>创建Recommend子目录,Recomend下创建index.js</p>
<details style="background:#d0edf5">
<summary>index.js</summary>

<p>  <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b38247c98864367a768f858f2241faa~tplv-k3u1fbpfcp-zoom-1.image" alt=""> </p>
</details>


<p>现在还不能运行，因为在app.js中没有导入路由(由于div会被编辑器吃掉😂，某些地方只能上图片)</p>
<h3 id="4-来到App-js"><a href="#4-来到App-js" class="headerlink" title="4. 来到App.js"></a>4. 来到App.js</h3><details style="background:#d0edf5;"> 
<summary>App.js</summary>
<pre><code >
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line">    <span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">"./routes/index.js"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; renderRoutes &#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; HashRouter &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">          &lt;HashRouter&gt;</span><br><span class="line">            &#123;renderRoutes(routes)&#125;</span><br><span class="line">          &lt;<span class="regexp">/HashRouter&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    export default App;</span></span><br><span class="line"><span class="regexp">    ```	</span></span><br><span class="line"><span class="regexp">&lt;/</span>code&gt;&lt;<span class="regexp">/pre&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>details&gt;</span><br><span class="line"></span><br><span class="line">我们将 routes里面的文件导入到了renderRoutes,renderRoutes就可以根据routes里面的组件在其他组件下放入其他组件了(就问你绕不绕，此其他非彼其他🤔)。这个理解了其实用起来感觉会很方便。</span><br><span class="line">到这我们安装两个包</span><br><span class="line"><span class="string">``</span><span class="string">`js</span></span><br><span class="line"><span class="string">yarn add react-router-config</span></span><br><span class="line"><span class="string">yarn add react-router-dom</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>	</span><br><span class="line">这个时候项目就可以运行起来了</span><br><span class="line">运行结果如下</span><br><span class="line">![](https:<span class="comment">//p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e34411e98093472aa5cb96792b861a35~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line">### 5. 配置 global-style.js 文件 以及全局样式</span><br><span class="line">src下创建 assets目录，创建该文件，该文件是通用样式文件(不要与全局样式混淆)，比如，该app的主题颜色(你懂的颜色)在许多地方都会用到</span><br><span class="line">&lt;details style=<span class="string">"background:#d0edf5"</span>&gt;</span><br><span class="line">&lt;summary&gt;global-style.js&lt;<span class="regexp">/summary&gt;</span></span><br><span class="line"><span class="regexp">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="regexp">    ```js</span></span><br><span class="line"><span class="regexp">    const extendClick = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      return `</span></span><br><span class="line"><span class="regexp">        position: relative;</span></span><br><span class="line"><span class="regexp">        &amp;:before&#123;</span></span><br><span class="line"><span class="regexp">          content: '';</span></span><br><span class="line"><span class="regexp">          position: absolute;</span></span><br><span class="line"><span class="regexp">          top: -10px; bottom: -10px; left: -10px; right: -10px;</span></span><br><span class="line"><span class="regexp">        &#125;;</span></span><br><span class="line"><span class="regexp">      `;</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    const noWrap = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      return `</span></span><br><span class="line"><span class="regexp">        text-overflow: ellipsis;</span></span><br><span class="line"><span class="regexp">        overflow: hidden;</span></span><br><span class="line"><span class="regexp">        white-space: nowrap;</span></span><br><span class="line"><span class="regexp">      `;</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    const bgFull = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      return `</span></span><br><span class="line"><span class="regexp">        background-position: 50%;</span></span><br><span class="line"><span class="regexp">        background-size: contain;</span></span><br><span class="line"><span class="regexp">        background-repeat: no-repeat;</span></span><br><span class="line"><span class="regexp">      `</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    export default &#123;</span></span><br><span class="line"><span class="regexp">      "theme-color": "#d44439", /</span><span class="regexp">/今天有绿吗</span></span><br><span class="line"><span class="regexp">      "theme-color-shadow": "rgba(212, 68, 57, .5)",</span></span><br><span class="line"><span class="regexp">      "font-color-light": "#f1f1f1",</span></span><br><span class="line"><span class="regexp">      "font-color-light-shadow": "rgba(241, 241, 241, 0.6)",/</span><span class="regexp">/略淡</span></span><br><span class="line"><span class="regexp">      "font-color-desc": "#2E3030",</span></span><br><span class="line"><span class="regexp">      "font-color-desc-v2": "#bba8a8", /</span><span class="regexp">/略淡</span></span><br><span class="line"><span class="regexp">      "font-size-ss": "10px",</span></span><br><span class="line"><span class="regexp">      "font-size-s": "12px",</span></span><br><span class="line"><span class="regexp">      "font-size-m": "14px",</span></span><br><span class="line"><span class="regexp">      "font-size-l": "16px",</span></span><br><span class="line"><span class="regexp">      "font-size-ll": "18px",</span></span><br><span class="line"><span class="regexp">      "border-color": "#e4e4e4",</span></span><br><span class="line"><span class="regexp">      "border-color-v2": "rgba(228, 228, 228, 0.1)",</span></span><br><span class="line"><span class="regexp">      "background-color": "#f2f3f4",</span></span><br><span class="line"><span class="regexp">      "background-color-shadow": "rgba(0, 0, 0, 0.3)",</span></span><br><span class="line"><span class="regexp">      "highlight-background-color": "#fff",</span></span><br><span class="line"><span class="regexp">      "official-red": "#E82001",</span></span><br><span class="line"><span class="regexp">      extendClick,</span></span><br><span class="line"><span class="regexp">      noWrap,</span></span><br><span class="line"><span class="regexp">      bgFull</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">    ```	</span></span><br><span class="line"><span class="regexp">&lt;/</span>code&gt;&lt;<span class="regexp">/pre&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>details&gt;</span><br><span class="line">全局样式，这个样式不仅仅在这里可以用到，其他的项目同样可以引入</span><br><span class="line">&lt;details style=<span class="string">"background:#d0edf5"</span>&gt;</span><br><span class="line">&lt;summary&gt;style.js&lt;<span class="regexp">/summary&gt;</span></span><br><span class="line"><span class="regexp">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="regexp">    ```js</span></span><br><span class="line"><span class="regexp">    import &#123; createGlobalStyle &#125; from 'styled-components'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    export const GlobalStyle = createGlobalStyle`</span></span><br><span class="line"><span class="regexp">        html, body, div, span, applet, object, iframe,</span></span><br><span class="line"><span class="regexp">        h1, h2, h3, h4, h5, h6, p, blockquote, pre,</span></span><br><span class="line"><span class="regexp">        a, abbr, acronym, address, big, cite, code,</span></span><br><span class="line"><span class="regexp">        del, dfn, em, img, ins, kbd, q, s, samp,</span></span><br><span class="line"><span class="regexp">        small, strike, strong, sub, sup, tt, var,</span></span><br><span class="line"><span class="regexp">        b, u, i, center,</span></span><br><span class="line"><span class="regexp">        dl, dt, dd, ol, ul, li,</span></span><br><span class="line"><span class="regexp">        fieldset, form, label, legend,</span></span><br><span class="line"><span class="regexp">        table, caption, tbody, tfoot, thead, tr, th, td,</span></span><br><span class="line"><span class="regexp">        article, aside, canvas, details, embed, </span></span><br><span class="line"><span class="regexp">        figure, figcaption, footer, header, hgroup, </span></span><br><span class="line"><span class="regexp">        menu, nav, output, ruby, section, summary,</span></span><br><span class="line"><span class="regexp">        time, mark, audio, video &#123;</span></span><br><span class="line"><span class="regexp">            margin: 0;</span></span><br><span class="line"><span class="regexp">            padding: 0;</span></span><br><span class="line"><span class="regexp">            border: 0;</span></span><br><span class="line"><span class="regexp">            font-size: 100%;</span></span><br><span class="line"><span class="regexp">            font: inherit;</span></span><br><span class="line"><span class="regexp">            vertical-align: baseline;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        /</span>* HTML5 display-role reset <span class="keyword">for</span> older browsers *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">        article, aside, details, figcaption, figure, </span></span><br><span class="line"><span class="regexp">        footer, header, hgroup, menu, nav, section &#123;</span></span><br><span class="line"><span class="regexp">            display: block;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        body &#123;</span></span><br><span class="line"><span class="regexp">            line-height: 1;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        html, body&#123;</span></span><br><span class="line"><span class="regexp">            background: #f2f3f4;;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        ol, ul &#123;</span></span><br><span class="line"><span class="regexp">            list-style: none;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        blockquote, q &#123;</span></span><br><span class="line"><span class="regexp">            quotes: none;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        blockquote:before, blockquote:after,</span></span><br><span class="line"><span class="regexp">        q:before, q:after &#123;</span></span><br><span class="line"><span class="regexp">            content: '';</span></span><br><span class="line"><span class="regexp">            content: none;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        table &#123;</span></span><br><span class="line"><span class="regexp">            border-collapse: collapse;</span></span><br><span class="line"><span class="regexp">            border-spacing: 0;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        a&#123;</span></span><br><span class="line"><span class="regexp">            text-decoration: none;</span></span><br><span class="line"><span class="regexp">            color: #fff;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    `</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>


<h3 id="6-开始写头部"><a href="#6-开始写头部" class="headerlink" title="6. 开始写头部"></a>6. 开始写头部</h3><p>这里我们将用到 比较新的知识<code style="color:red;">styled.components</code>以及需要<code style="color:red;">iconfont</code> , 来到HomeLayout下，</p>
<details style="background:#d0edf5">
<summary>HomeLayout.js</summary>

<p>   <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74e5ded5340f4cdf8a1cfb03661ad694~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
</details>

<p>这里我们导入了HomeLayout.style.js(styled.componets)以及<code style="color:red;"> &#xe65c;</code>(iconfont)，未加iconfont类似于‘口’，因此我们需要创建它们。styled.components就类似于在js文件里面写样式，并且该容器的class会随机生成。<br>从如下代码我们可以看到Top就是一个容器，它的子容器的样式也可以在这里写，然后导入上面的HomeLayout.js.</p>
<h3 id="7-在同级目录下创建HomeLayout-style-js"><a href="#7-在同级目录下创建HomeLayout-style-js" class="headerlink" title="7. 在同级目录下创建HomeLayout.style.js"></a>7. 在同级目录下创建HomeLayout.style.js</h3><details style="background:#d0edf5">
<summary>HomeLayout.style.js</summary>
<pre><code>
     <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">"styled-components"</span>;</span><br><span class="line">    <span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">"../assets/global-style"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> Top = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      flex-direction: row;</span></span><br><span class="line"><span class="string">      justify-content: space-between;</span></span><br><span class="line"><span class="string">      padding: 5px 10px;</span></span><br><span class="line"><span class="string">      background: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">      &amp; &gt; span &#123;</span></span><br><span class="line"><span class="string">        line-height: 40px;</span></span><br><span class="line"><span class="string">        color: #f1f1f1;</span></span><br><span class="line"><span class="string">        font-size: 20px;</span></span><br><span class="line"><span class="string">        &amp;.iconfont &#123;</span></span><br><span class="line"><span class="string">          font-size: 25px;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    <span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">&lt;/code&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">将这段代码引入之后就可以看到效果了</span></span><br><span class="line"><span class="string">此时运行结果如下</span></span><br><span class="line"><span class="string">![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/db7f42236a704b67b688b32e12d05ba1~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string">因为还没有配置iconfont,所以是如上效果</span></span><br><span class="line"><span class="string">### 8. 配置iconfont</span></span><br><span class="line"><span class="string">可以到icontfont官网下载所需要的文件，放在assets目录下，目录如下</span></span><br><span class="line"><span class="string">![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be6982fc567b44fbb4bc65dd33c40730~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string">在全局App.js引入icontfont文件，加上这几行代码</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> &#123; IconStyle &#125; <span class="keyword">from</span> <span class="string">"./assets/iconfont/iconfont"</span>;</span><br><span class="line">&lt;HashRouter&gt;</span><br><span class="line">   &lt;IconStyle&gt;&lt;<span class="regexp">/IconStyle&gt;</span></span><br><span class="line"><span class="regexp">   &#123;renderRoutes(routes)&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>HashRouter&gt;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">运行效果如下，图标出来了</span></span><br><span class="line"><span class="string">![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e026c85b69742a0b092451a1c3ea771~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string">### 9. 接着在 HomeLayout.js 写布局</span></span><br><span class="line"><span class="string">在原来的的基础上加上如下代码&lt;Top&gt;下面写</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt;</span></span><br><span class="line"><span class="string">&lt;summary&gt;HomeLayout.js&lt;/summary&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7903bf78b8da4471ac8759c6dc832ee1~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string">这里我们用NavLink指向了三个路由地址，我们目前只做recommend</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">上面引入了 &lt;Tab&gt;&lt;TabItem&gt;,在HomeLayout.style.js写</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt;</span></span><br><span class="line"><span class="string">&lt;summary&gt;HomeLayout.style.js&lt;/summary&gt;</span></span><br><span class="line"><span class="string">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="string">    `</span><span class="string">``</span>js</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> Tab = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">      height: 44px;</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      flex-direction: row;</span></span><br><span class="line"><span class="string">      justify-content: space-around;</span></span><br><span class="line"><span class="string">      background: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">      a &#123;</span></span><br><span class="line"><span class="string">        flex: 1;</span></span><br><span class="line"><span class="string">        padding: 2px 0;</span></span><br><span class="line"><span class="string">        font-size: 14px;</span></span><br><span class="line"><span class="string">        color: #e4e4e4;</span></span><br><span class="line"><span class="string">        &amp;.selected &#123;</span></span><br><span class="line"><span class="string">          span &#123;</span></span><br><span class="line"><span class="string">            padding: 3px 0;</span></span><br><span class="line"><span class="string">            font-weight: 700;</span></span><br><span class="line"><span class="string">            color: #f1f1f1;</span></span><br><span class="line"><span class="string">            border-bottom: 2px solid #f1f1f1;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> TabItem = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">      height: 100%;</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      flex-direction: row;</span></span><br><span class="line"><span class="string">      justify-content: center;</span></span><br><span class="line"><span class="string">      align-items: center;</span></span><br><span class="line"><span class="string">    `</span>;</span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>页面结果如下<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b730a1c6138498bb924dc87781220f9~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h3 id="10-来到了难点重点部分。"><a href="#10-来到了难点重点部分。" class="headerlink" title="10. 来到了难点重点部分。"></a>10. 来到了难点重点部分。</h3><p>前面的都是一些基础的不需要从后端获取数据就可以完成的，但是接下来的内容轮播图，以及列表都是需要从后端接口请求数据渲染到页面。<br>数据拿到了也需要人来管理，那么谁呢，就是你又爱又恨的<code style="color:red;">redux</code>。<br/><br>接下来首先得准备好接口数据<br>src下创建api文件夹，在该文件夹下配置<code style="color:red;">config.js</code>文件， 该文件一般是用来配置默认后端请求接口路径</p>
<details style="background:#d0edf5">
<summary>config.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> baseUrl = <span class="string">"http://neteasecloudmusicapi.zhaoboy.com"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个axios的实例及拦截器配置</span></span><br><span class="line">    <span class="keyword">const</span> axiosInstance = axios.create(&#123;</span><br><span class="line">      baseURL: baseUrl</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 响应拦截器，在获取响应之前处理数据</span></span><br><span class="line">    axiosInstance.interceptors.response.use(</span><br><span class="line">      res =&gt; res.data,</span><br><span class="line">      err =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err, <span class="string">"网络错误"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> &#123; axiosInstance &#125;;</span><br><span class="line">    <span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">&lt;/code&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 11. 同路径api下创建request.js</span></span><br><span class="line"><span class="string">该文件用来封装 请求接口，通过调用该函数可以请求数据</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> &#123; axiosInstance &#125; <span class="keyword">from</span> <span class="string">"./config"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getBannerRequest = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> axiosInstance.get(<span class="string">"/banner"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">### 12. 创建redux 仓库</span></span><br><span class="line"><span class="string">需要说明的是，神三元项目中每个对应的路由组件都有一个store,然后将所有的store(该store中没有store文件，一个项目只应该有一个仓库)全部引入到最外面的store，这样写的理由是逻辑清晰。如果不这样写很多action放到一起，很多reducer放到一起，文件数量可能会较大，头都大了。&lt;br/&gt;</span></span><br><span class="line"><span class="string">那么用redux怎么管理数据呢？简单说就是dispatch(action)向store请求数据，store又找reducer,reducer对请求的数据进行一定的操作，存到store,在组件中connect一下，再通过props获取数据</span></span><br><span class="line"><span class="string">![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ebdeb84be27e4f5aa2cbae6373e178e2~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string">我们在Recommend下创建store文件夹，分别创建     </span></span><br><span class="line"><span class="string">&lt;code style="color:red;"&gt;constants.js&lt;/code&gt;</span></span><br><span class="line"><span class="string">&lt;code style="color:red;"&gt;actionCreators.js&lt;/code&gt;</span></span><br><span class="line"><span class="string">&lt;code style="color:red;"&gt;reducer.js&lt;/code&gt;</span></span><br><span class="line"><span class="string">&lt;code style="color:red;"&gt;index.js&lt;/code&gt;</span></span><br><span class="line"><span class="string">#### 12.1 constants.js</span></span><br><span class="line"><span class="string">该文件只有一行代码，作用是区分不同的actions </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_BANNER = <span class="string">'home/recommend/CHANGE_BANNER'</span>;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 12.2 actionCreators.js </span></span><br><span class="line"><span class="string">该文件中有 changeBannerList 用来改变状态，也就是传进来什么数据就修改成什么数据，但是为了支持异步，我们需要通过下面一个getBannerList来获取数据</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt; </span></span><br><span class="line"><span class="string">&lt;summary&gt;actionCreators.js&lt;/summary&gt;</span></span><br><span class="line"><span class="string">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="string">     `</span><span class="string">``</span>js</span><br><span class="line">    <span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; getBannerRequest &#125; <span class="keyword">from</span> <span class="string">'../../../api/request'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> changeBannerList = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123;</span><br><span class="line">      type: actionTypes.CHANGE_BANNER,</span><br><span class="line">      data: fromJS(data)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 获取 轮播图数据</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> getBannerList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">        getBannerRequest().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> action = changeBannerList(data.banners);</span><br><span class="line">          dispatch(action);</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"轮播图数据传输错误"</span>);</span><br><span class="line">        &#125;) </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">&lt;/code&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意，我们在这里使用了immutable,以后的文件会大量用到immutable,简单介绍下作用: 使用旧数据创建新数据时可以保证新数据不变，并且创建新数据的过程中使用了结构共享，如下图所示</span></span><br><span class="line"><span class="string">![](https://user-gold-cdn.xitu.io/2018/4/4/1628e77dc419816b?imageslim)</span></span><br><span class="line"><span class="string">在上面的代码中我们导入getBannerRequest的请求，getBannerList 返回的是一个方法，我们需要在store导入redux-thunk包,这是后面写到的。&lt;br/&gt;</span></span><br><span class="line"><span class="string">#### 12.3 reducer.js</span></span><br><span class="line"><span class="string">reducer.js 首先初始化bannerList的数据，然后switch一顿狂操作</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt; </span></span><br><span class="line"><span class="string">&lt;summary&gt;reducer.js&lt;/summary&gt;</span></span><br><span class="line"><span class="string">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="string">    `</span><span class="string">``</span>js</span><br><span class="line">    <span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> defaultState = fromJS(&#123;</span><br><span class="line">      bannerList: [],</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> (state = defaultState, action) =&gt; &#123;</span><br><span class="line">      <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> actionTypes.CHANGE_BANNER:</span><br><span class="line">          <span class="keyword">return</span> state.set(<span class="string">'bannerList'</span>, action.data);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">return</span> state;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">&lt;/code&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 12.4 index.js</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'./actionCreators'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">'./constants'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer, actionCreators, constants &#125;;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">将三个文件整合，并导出</span></span><br><span class="line"><span class="string">以上是Recommend 里面的store,(再次说明: 里面的store是没有仓库的，统一放到外面的仓库管理)，我们需要创建 外面最大的store</span></span><br><span class="line"><span class="string">### 13. 在src 创建 store文件夹(最外面的仓库)</span></span><br><span class="line"><span class="string">store 下创建 reducer.js 集合所有reducer, index.js 仓库</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">reducer.js</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">"redux-immutable"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reducer <span class="keyword">as</span> recommendReducer &#125; <span class="keyword">from</span> <span class="string">"../application/Recommend/store/index"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">  recommend: recommendReducer,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">index.js, 这里我们安装了 redux-thunk,支持action返回方法</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> &#123; createStore, compose, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">"redux-thunk"</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducer"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> composeEnhancers = <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, composeEnhancers(applyMiddleware(thunk)));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">14. 在App.js 引入store,使之成为全局仓库</span></span><br><span class="line"><span class="string">现在App.js文件长这样</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt; </span></span><br><span class="line"><span class="string">&lt;summary&gt;代码&lt;/summary&gt;</span></span><br><span class="line"><span class="string">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="string">    `</span><span class="string">``</span>js</span><br><span class="line">    <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line">    <span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">"./routes/index.js"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; renderRoutes &#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; HashRouter &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; IconStyle &#125; <span class="keyword">from</span> <span class="string">"./assets/iconfont/iconfont"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store/index"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">          &lt;HashRouter&gt;</span><br><span class="line">            &lt;IconStyle&gt;&lt;<span class="regexp">/IconStyle&gt;</span></span><br><span class="line"><span class="regexp">            &#123;renderRoutes(routes)&#125;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>HashRouter&gt;</span><br><span class="line">        &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    export default App;</span></span><br><span class="line"><span class="regexp">    ```	</span></span><br><span class="line"><span class="regexp">&lt;/</span>code&gt;&lt;<span class="regexp">/pre&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>details&gt;</span><br><span class="line"></span><br><span class="line">需要导入一个Provider，使得全局都可以使用store里面的数据</span><br><span class="line">到这里我们终于把Recommend的数据管理给搞定了，下载必要的包</span><br><span class="line">yarn add axios redux react-reudx immutable redux-immutable redux-thunk (可能不全)</span><br><span class="line">接下里就是如何将数据渲染到页面了。</span><br><span class="line"></span><br><span class="line">### 15. 来到HomeLayout的子组件Recommend下的 index.js 中</span><br><span class="line">首先我们先通过connect拿到数据</span><br><span class="line">&lt;details style=<span class="string">"background:#d0edf5"</span>&gt; </span><br><span class="line">&lt;summary&gt;index.js&lt;<span class="regexp">/summary&gt;</span></span><br><span class="line"><span class="regexp">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">![](https:/</span><span class="regexp">/p9-juejin.byteimg.com/</span>tos-cn-i-k3u1fbpfcp/<span class="number">4</span>b9db461c6ae4473ac4e8b4bafef023e~tplv-k3u1fbpfcp-zoom<span class="number">-1.</span>image)</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/code&gt;&lt;/</span>pre&gt;</span><br><span class="line">&lt;<span class="regexp">/details&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">connect 之后怎么拿数据呢？ 通过props可以获取数据，接下来我们来写如何通过props获取数据</span></span><br><span class="line"><span class="regexp">&lt;details style="background:#d0edf5"&gt; </span></span><br><span class="line"><span class="regexp">&lt;summary&gt;index.js&lt;/</span>summary&gt;</span><br><span class="line">&lt;pre&gt;<span class="xml"><span class="tag">&lt;<span class="name">code</span>&gt;</span></span></span><br><span class="line"><span class="xml">```js</span></span><br><span class="line"><span class="xml">    function Recommend(props) &#123;</span></span><br><span class="line"><span class="xml">      const &#123; bannerList&#125; = props;</span></span><br><span class="line"><span class="xml">      const &#123; getBannerDataDispatch &#125; = props;</span></span><br><span class="line"><span class="xml">      useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">        if(!bannerList.size)&#123;</span></span><br><span class="line"><span class="xml">          getBannerDataDispatch();</span></span><br><span class="line"><span class="xml">          console.log(bannerList);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">      &#125;, []);</span></span><br><span class="line"><span class="xml">      return (</span></span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          Recommend</span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      )</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br></pre></td></tr></table></figure>

<p></code></pre></p>
</details>

<p>只要connect之后，我们就可以通过props拿到数据了，props之后解构刚刚上面的bannerList数据和getBannerDataDispatch方法，调用该方法之后就可以获取数据，所以我们把它放到useEffect,中，判断bannerList是否为空，不用每次执行都请求一次数据。打印之后我们可以看到如下结果<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cb087d9f61c41ad951e91be3ed40018~tplv-k3u1fbpfcp-zoom-1.image" alt=""><br>数据拿到了，现在要做轮播图，因为轮播图可能多个地方都会用到，所以我们将它放到components目录下</p>
<h3 id="16-创建slider"><a href="#16-创建slider" class="headerlink" title="16. 创建slider"></a>16. 创建slider</h3><p>在src下创建components文件夹，接着创建slider文件夹，在里面创建 index.js和style.js</p>
<p>style.js, 这是给swiper加的样式，引入了Global-style里面的主题颜色</p>
<details style="background:#d0edf5"> 
<summary>style.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'../../assets/global-style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SliderContainer = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  position: relative;</span></span><br><span class="line"><span class="string">  box-sizing: border-box;</span></span><br><span class="line"><span class="string">  width: 100%;</span></span><br><span class="line"><span class="string">  height: 100%;</span></span><br><span class="line"><span class="string">  margin: auto;</span></span><br><span class="line"><span class="string">  background: white;</span></span><br><span class="line"><span class="string">  .before&#123;</span></span><br><span class="line"><span class="string">    position: absolute;</span></span><br><span class="line"><span class="string">    top: -300px;</span></span><br><span class="line"><span class="string">    height: 400px;</span></span><br><span class="line"><span class="string">    width: 100%;</span></span><br><span class="line"><span class="string">    background: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">    z-index: 1;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  .slider-container&#123;</span></span><br><span class="line"><span class="string">    position: relative;</span></span><br><span class="line"><span class="string">    width: 98%;</span></span><br><span class="line"><span class="string">    height: 160px;</span></span><br><span class="line"><span class="string">    overflow: hidden;</span></span><br><span class="line"><span class="string">    margin: auto;</span></span><br><span class="line"><span class="string">    border-radius: 6px;</span></span><br><span class="line"><span class="string">    .slider-nav&#123;</span></span><br><span class="line"><span class="string">      position: absolute;</span></span><br><span class="line"><span class="string">      display: block;</span></span><br><span class="line"><span class="string">      width: 100%;</span></span><br><span class="line"><span class="string">      height: 100%;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    .swiper-pagination-bullet-active&#123;</span></span><br><span class="line"><span class="string">      background: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>
index.js
<details style="background:#d0edf5"> 
<summary>代码</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"swiper/swiper-bundle.min.css"</span>; <span class="comment">//这里引用的方式已经发生了变化</span></span><br><span class="line"><span class="keyword">import</span> Swiper <span class="keyword">from</span> <span class="string">"swiper"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SliderContainer &#125; <span class="keyword">from</span> <span class="string">'./style'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Slider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [sliderSwiper, setSliderSwiper] = useState(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; bannerList &#125; = props;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(bannerList.length &amp;&amp; !sliderSwiper)&#123;</span><br><span class="line">      <span class="keyword">let</span> sliderSwiper = <span class="keyword">new</span> Swiper(<span class="string">".slider-container"</span>, &#123;</span><br><span class="line">        loop: <span class="literal">true</span>,</span><br><span class="line">        autoplay: &#123;</span><br><span class="line">          delay: <span class="number">3000</span>,</span><br><span class="line">          disableOnInteraction: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        pagination: &#123;<span class="attr">el</span>:<span class="string">'.swiper-pagination'</span>&#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">      setSliderSwiper(sliderSwiper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;, [bannerList.length, sliderSwiper])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;SliderContainer&gt;</span><br><span class="line">       &lt;div className=<span class="string">"before"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">       &lt;div className="slider-container"&gt;</span></span><br><span class="line"><span class="regexp">       &lt;div className="swiper-wrapper"&gt;</span></span><br><span class="line"><span class="regexp">         &#123;</span></span><br><span class="line"><span class="regexp">           bannerList.map(slider =&gt; &#123;</span></span><br><span class="line"><span class="regexp">             return (</span></span><br><span class="line"><span class="regexp">              &lt;div className="swiper-slide" key=&#123;slider.imageUrl&#125;&gt;</span></span><br><span class="line"><span class="regexp">                 &lt;div className="slider-nav"&gt;</span></span><br><span class="line"><span class="regexp">                 &lt;img src=&#123;slider.imageUrl&#125; width="100%" height="100%" alt="推荐" /</span>&gt;</span><br><span class="line">                 &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">             )</span><br><span class="line">           &#125;)</span><br><span class="line">         &#125;</span><br><span class="line">       &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">       &lt;div className="swiper-pagination"&gt;&lt;/</span>div&gt;</span><br><span class="line">       &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>SliderContainer&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.memo(Slider);</span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>这里主要是使用了swiper api, 具体用法可以看<a href="https://www.swiper.com.cn/api/index.html" target="_blank" rel="noopener">swiper官网</a>有详细介绍</p>
<h3 id="17-导入slider"><a href="#17-导入slider" class="headerlink" title="17. 导入slider"></a>17. 导入slider</h3><p>swiper 写完了之后，来到，recommend 下的index.js, 首先为index.js写个style.js</p>
<details style="background:#d0edf5"> 
<summary>style.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Content = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    position: fixed;</span></span><br><span class="line"><span class="string">    top: 94px;</span></span><br><span class="line"><span class="string">    left: 0;</span></span><br><span class="line"><span class="string">    bottom: <span class="subst">$&#123;props =&gt; props.play &gt; <span class="number">0</span>?<span class="string">"60px"</span>: <span class="number">0</span>&#125;</span>;</span></span><br><span class="line"><span class="string">    width: 100%;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>在index.js中导入Slider</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Content &#125; <span class="keyword">from</span> <span class="string">"./style"</span>;</span><br><span class="line"><span class="keyword">import</span> Slider <span class="keyword">from</span> <span class="string">"../../components/slider/"</span>;</span><br><span class="line"> <span class="keyword">const</span> bannerListJS = bannerList ? bannerList.toJS() : [];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Content &gt;</span><br><span class="line">      &lt;div&gt;<span class="xml"><span class="tag">&lt;<span class="name">Slider</span> <span class="attr">bannerList</span>=<span class="string">&#123;bannerListJS&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Slider</span>&gt;</span></span>&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Content&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 index.js加上上面这几句代码之后就可以看到效果了,但是你会发现header被覆盖了，这里其实是 Slider组件里面的before搞的鬼， 如果要改过来也很简单，在它的父容器加个overflow:hidden就可以解决问题，但是现在因为我们要做滚动(需要上下可以滚动)，滚动会做slider的父容器，也会有overflow:hidden,所以这里就先不处理。<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f699119a0c646a48469b20202eebab5~tplv-k3u1fbpfcp-zoom-1.image" alt=""><br>但是我们发现这个轮播图是不能滚动的，因为我们现在用的swiper 是swiper6最新版本，具体的可以看官网如何使用</p>
<h3 id="18-loading组件"><a href="#18-loading组件" class="headerlink" title="18. loading组件"></a>18. loading组件</h3><p>讲解scroll组件又会牵扯到 loading 组件(加载)和 debounce函数(防抖)，所以得先建loading组件和防抖函数<br>baseUI文件下分别创建loading和loading-v2文件夹</p>
<p>loading中的文件</p>
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> styled, &#123; keyframes &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'../../assets/global-style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loading = keyframes<span class="string">`</span></span><br><span class="line"><span class="string">  0%, 100% &#123;</span></span><br><span class="line"><span class="string">    transform: scale(0.0);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  50% &#123;</span></span><br><span class="line"><span class="string">    transform: scale(1.0);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="keyword">const</span> LoadingWrapper = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    &gt;div &#123;</span></span><br><span class="line"><span class="string">      position: absolute;</span></span><br><span class="line"><span class="string">      top: 0; left: 0; right: 0; bottom: 0;</span></span><br><span class="line"><span class="string">      margin: auto;</span></span><br><span class="line"><span class="string">      width: 60px;</span></span><br><span class="line"><span class="string">      height: 60px;</span></span><br><span class="line"><span class="string">      opacity: 0.6;</span></span><br><span class="line"><span class="string">      border-radius: 50%;</span></span><br><span class="line"><span class="string">      background-color: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">      animation: <span class="subst">$&#123;loading&#125;</span> 1.4s infinite ease-in;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(2) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.7s;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params"></span>)  </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;LoadingWrapper&gt;</span><br><span class="line">      &lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/LoadingWrapper&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default React.memo(Loading);</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>
loading-v2中的文件
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> styled, &#123;keyframes&#125; <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'../../assets/global-style'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dance = keyframes<span class="string">`</span></span><br><span class="line"><span class="string">    0%, 40%, 100%&#123;</span></span><br><span class="line"><span class="string">      transform: scaleY(0.4);</span></span><br><span class="line"><span class="string">      transform-origin: center 100%;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    20%&#123;</span></span><br><span class="line"><span class="string">      transform: scaleY(1);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="keyword">const</span> Loading = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    height: 10px;</span></span><br><span class="line"><span class="string">    width: 100%;</span></span><br><span class="line"><span class="string">    margin: auto;</span></span><br><span class="line"><span class="string">    text-align: center;</span></span><br><span class="line"><span class="string">    font-size: 10px;</span></span><br><span class="line"><span class="string">    &gt;div&#123;</span></span><br><span class="line"><span class="string">      display: inline-block;</span></span><br><span class="line"><span class="string">      background-color: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">      height: 100%;</span></span><br><span class="line"><span class="string">      width: 1px;</span></span><br><span class="line"><span class="string">      margin-right:2px;</span></span><br><span class="line"><span class="string">      animation: <span class="subst">$&#123;dance&#125;</span> 1s infinite;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(2) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.4s;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(3) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.6s;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(4) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.5s;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(5) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.2s;</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingV2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Loading&gt;</span><br><span class="line">      &lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;&lt;/</span>div&gt;</span><br><span class="line">      &lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;&lt;/</span>div&gt;</span><br><span class="line">      &lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;拼命加载中...&lt;/</span>span&gt;</span><br><span class="line">    &lt;<span class="regexp">/Loading&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default React.memo(LoadingV2);</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>这两个文件都是用animation做的加载动画，具体就不介绍了，篇幅过长~</p>
<h3 id="19-debounce-函数"><a href="#19-debounce-函数" class="headerlink" title="19. debounce 函数"></a>19. debounce 函数</h3><p>防抖函数建在 api 的 utils.js 中<br>什么是防抖</p>
<p><strong><em>举个栗子：</em></strong>有个scroll事件，滚动会不停触发回滚动事件，从而调用绑定的回调函数，我们希望当我们停止滚动的时，才触发一次回调，这时可以使用函数防抖。</p>
<details style="background:#d0edf5"> 
<summary>代码</summary>
<pre><code>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> debounce = <span class="function">(<span class="params">func, delay</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(timer) &#123;</span><br><span class="line">      clearTimeout(timer);</span><br><span class="line">    &#125;</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      func.apply(<span class="keyword">this</span>, args);</span><br><span class="line">      clearTimeout(timer);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123; debounce &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</details>
这是三元写的原生js防抖函数，防抖原理就是第一次触发某个函数，在规定时间内如果再次触发就会重新计时。

<h3 id="20-scroll"><a href="#20-scroll" class="headerlink" title="20. scroll"></a>20. scroll</h3><p>好了，预备工作完成了，就可以写了，这里再说明一下，我现在是尽可能的帮助大家梳理如何能够看懂一个比较好的项目，实现可以自己动手实践</p>
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;</span><br><span class="line">  forwardRef,</span><br><span class="line">  useState,</span><br><span class="line">  useEffect,</span><br><span class="line">  useRef,</span><br><span class="line">  useImperativeHandle,</span><br><span class="line">  useMemo,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> BScroll <span class="keyword">from</span> <span class="string">"better-scroll"</span>;</span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">"styled-components"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debounce &#125; <span class="keyword">from</span> <span class="string">"../../api/utils"</span>;</span><br><span class="line"><span class="keyword">import</span> Loading <span class="keyword">from</span> <span class="string">'../loading/index'</span>;</span><br><span class="line"><span class="keyword">import</span> Loading2 <span class="keyword">from</span> <span class="string">'../loading-v2/index'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ScrollContainer = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  width: 100%;</span></span><br><span class="line"><span class="string">  height: 100%;</span></span><br><span class="line"><span class="string">  overflow: hidden;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PullUpLoading = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  position: absolute;</span></span><br><span class="line"><span class="string">  left: 0;</span></span><br><span class="line"><span class="string">  right: 0;</span></span><br><span class="line"><span class="string">  bottom: 5px;</span></span><br><span class="line"><span class="string">  width: 60px;</span></span><br><span class="line"><span class="string">  height: 60px;</span></span><br><span class="line"><span class="string">  margin: auto;</span></span><br><span class="line"><span class="string">  z-index: 100;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PullDownLoading = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  position: absolute;</span></span><br><span class="line"><span class="string">  left: 0;</span></span><br><span class="line"><span class="string">  right: 0;</span></span><br><span class="line"><span class="string">  top: 0px;</span></span><br><span class="line"><span class="string">  height: 30px;</span></span><br><span class="line"><span class="string">  margin: auto;</span></span><br><span class="line"><span class="string">  z-index: 100;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> Scroll = forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [bScroll, setBScroll] = useState();</span><br><span class="line">  <span class="keyword">const</span> scrollContaninerRef = useRef();</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    direction,</span><br><span class="line">    click,</span><br><span class="line">    refresh,</span><br><span class="line">    pullUpLoading,</span><br><span class="line">    pullDownLoading,</span><br><span class="line">    bounceTop,</span><br><span class="line">    bounceBottom,</span><br><span class="line">  &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> &#123; pullUp, pullDown, onScroll &#125; = props;</span><br><span class="line">  <span class="keyword">let</span> pullUpDebounce = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> debounce(pullUp, <span class="number">500</span>);</span><br><span class="line">  &#125;, [pullUp]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> pullDownDebounce = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> debounce(pullDown, <span class="number">500</span>);</span><br><span class="line">  &#125;, [pullDown]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> scroll = <span class="keyword">new</span> BScroll(scrollContaninerRef.current, &#123;</span><br><span class="line">      scrollX: direction === <span class="string">"horizental"</span>,</span><br><span class="line">      scrollY: direction === <span class="string">"vertical"</span>,</span><br><span class="line">      probeType: <span class="number">3</span>,</span><br><span class="line">      click: click,</span><br><span class="line">      bounce: &#123;</span><br><span class="line">        top: bounceTop,</span><br><span class="line">        bottom: bounceBottom,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    setBScroll(scroll);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setBScroll(<span class="literal">null</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!bScroll || !onScroll) <span class="keyword">return</span>;</span><br><span class="line">    bScroll.on(<span class="string">"scroll"</span>, onScroll);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      bScroll.off(<span class="string">"scroll"</span>, onScroll);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [onScroll, bScroll]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!bScroll || !pullUp) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> handlePullUp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//判断是否滑动到了底部</span></span><br><span class="line">      <span class="keyword">if</span> (bScroll.y &lt;= bScroll.maxScrollY + <span class="number">100</span>) &#123;</span><br><span class="line">        pullUpDebounce();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    bScroll.on(<span class="string">"scrollEnd"</span>, handlePullUp);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      bScroll.off(<span class="string">"scrollEnd"</span>, handlePullUp);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [pullUp, pullUpDebounce, bScroll]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!bScroll || !pullDown) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> handlePullDown = <span class="function">(<span class="params">pos</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//判断用户的下拉动作</span></span><br><span class="line">      <span class="keyword">if</span> (pos.y &gt; <span class="number">50</span>) &#123;</span><br><span class="line">        pullDownDebounce();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    bScroll.on(<span class="string">"touchEnd"</span>, handlePullDown);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      bScroll.off(<span class="string">"touchEnd"</span>, handlePullDown);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [pullDown, pullDownDebounce, bScroll]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (refresh &amp;&amp; bScroll) &#123;</span><br><span class="line">      bScroll.refresh();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useImperativeHandle(ref, () =&gt; (&#123;</span><br><span class="line">    refresh() &#123;</span><br><span class="line">      <span class="keyword">if</span> (bScroll) &#123;</span><br><span class="line">        bScroll.refresh();</span><br><span class="line">        bScroll.scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getBScroll() &#123;</span><br><span class="line">      <span class="keyword">if</span> (bScroll) &#123;</span><br><span class="line">        <span class="keyword">return</span> bScroll;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">const</span> PullUpdisplayStyle = pullUpLoading</span><br><span class="line">    ? &#123; <span class="attr">display</span>: <span class="string">""</span> &#125;</span><br><span class="line">    : &#123; <span class="attr">display</span>: <span class="string">"none"</span> &#125;;</span><br><span class="line">  <span class="keyword">const</span> PullDowndisplayStyle = pullDownLoading</span><br><span class="line">    ? &#123; <span class="attr">display</span>: <span class="string">""</span> &#125;</span><br><span class="line">    : &#123; <span class="attr">display</span>: <span class="string">"none"</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ScrollContainer ref=&#123;scrollContaninerRef&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">      &#123;<span class="comment">/* 滑到底部加载动画 */</span>&#125;</span><br><span class="line">      &lt;PullUpLoading style=&#123;PullUpdisplayStyle&#125;&gt;</span><br><span class="line">        &lt;Loading&gt;&lt;<span class="regexp">/Loading&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>PullUpLoading&gt;</span><br><span class="line">      &#123;<span class="comment">/* 顶部下拉刷新动画 */</span>&#125;</span><br><span class="line">      &lt;PullDownLoading style=&#123;PullDowndisplayStyle&#125;&gt;</span><br><span class="line">        &lt;Loading2&gt;&lt;<span class="regexp">/Loading2&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>PullDownLoading&gt;</span><br><span class="line">    &lt;<span class="regexp">/ScrollContainer&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp">Scroll.defaultProps = &#123;</span></span><br><span class="line"><span class="regexp">  direction: "vertical",</span></span><br><span class="line"><span class="regexp">  click: true,</span></span><br><span class="line"><span class="regexp">  refresh: true,</span></span><br><span class="line"><span class="regexp">  onScroll: null,</span></span><br><span class="line"><span class="regexp">  pullUpLoading: false,</span></span><br><span class="line"><span class="regexp">  pullDownLoading: false,</span></span><br><span class="line"><span class="regexp">  pullUp: null,</span></span><br><span class="line"><span class="regexp">  pullDown: null,</span></span><br><span class="line"><span class="regexp">  bounceTop: true,</span></span><br><span class="line"><span class="regexp">  bounceBottom: true,</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">Scroll.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  direction: PropTypes.oneOf(["vertical", "horizental"]),</span></span><br><span class="line"><span class="regexp">  refresh: PropTypes.bool,</span></span><br><span class="line"><span class="regexp">  onScroll: PropTypes.func,</span></span><br><span class="line"><span class="regexp">  pullUp: PropTypes.func,</span></span><br><span class="line"><span class="regexp">  pullDown: PropTypes.func,</span></span><br><span class="line"><span class="regexp">  pullUpLoading: PropTypes.bool,</span></span><br><span class="line"><span class="regexp">  pullDownLoading: PropTypes.bool,</span></span><br><span class="line"><span class="regexp">  bounceTop: PropTypes.bool, /</span><span class="regexp">/是否支持向上吸顶</span></span><br><span class="line"><span class="regexp">  bounceBottom: PropTypes.bool, /</span><span class="regexp">/是否支持向下吸顶</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">export default Scroll;</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>这里用到的是<a href="https://github.com/ustbhuangyi/better-scroll/blob/master/README_zh-CN.md" target="_blank" rel="noopener">better-scroll</a>,同样的，因为这里用到了better-scroll，一讲可能就是一篇长篇文章。</p>
<h3 id="21-完成轮播图和scroll"><a href="#21-完成轮播图和scroll" class="headerlink" title="21. 完成轮播图和scroll"></a>21. 完成轮播图和scroll</h3><p>上面的操作都完成了之后，终于要完成轮播和滚动了。</p>
<p>来到recommend下index.js,只要导入scroll然后slider用scroll包裹起来就好了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Scroll <span class="keyword">from</span> <span class="string">'../../baseUI/scroll/index'</span>;</span><br><span class="line">&lt;Scroll className=<span class="string">"list"</span> onScroll=&#123;forceCheck&#125;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Slider bannerList=&#123;bannerListJS&#125;&gt;&lt;<span class="regexp">/Slider&gt;</span></span><br><span class="line"><span class="regexp">      &lt;RecommendList recommendList=&#123;recommendListJS&#125;&gt;&lt;/</span>RecommendList&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Scroll&gt;</span><br></pre></td></tr></table></figure>
<p>现在的效果图如下<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d93a6d672cf4759aaee455f57e1c4f7~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h3 id="22-列表数据api"><a href="#22-列表数据api" class="headerlink" title="22. 列表数据api"></a>22. 列表数据api</h3><p>request.js下增加一条请求 列表数据的方法getRecommendListRequest</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; axiosInstance &#125; <span class="keyword">from</span> <span class="string">"./config"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getBannerRequest = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> axiosInstance.get(<span class="string">"/banner"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRecommendListRequest = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> axiosInstance.get(<span class="string">"/personalized"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="23-列表-redux"><a href="#23-列表-redux" class="headerlink" title="23. 列表 redux"></a>23. 列表 redux</h3><p>接下来轻车熟路，又是像之前写 轮播图 redux一样 写 列表的 redux<br>还是原来的 recommend store下的文件夹<br>constants.js,增加一个常量,用于请求列表数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_BANNER = <span class="string">'home/recommend/CHANGE_BANNER'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_RECOMMEND_LIST = <span class="string">'home/recommend/RECOMMEND_LIST'</span>;</span><br></pre></td></tr></table></figure>

<p>actionCreators.js, 请求列表数据的changeRecommendList，可以异步的getRecommendList</p>
<details style="background:#d0edf5"> 
<summary>actionCreators.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> changeRecommendList = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: actionTypes.CHANGE_RECOMMEND_LIST,</span><br><span class="line">  data: fromJS(data)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRecommendList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    getRecommendListRequest().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(changeRecommendList(data.result));</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"推荐歌单数据传输错误"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>reducer.js，增加了另外一个初始化recommenList,以及一个case</p>
<details style="background:#d0edf5"> 
<summary>reducer.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">"./constants"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">"immutable"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState = fromJS(&#123;</span><br><span class="line">  bannerList: [],</span><br><span class="line">  recommendList: [],</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state = defaultState, action) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> actionTypes.CHANGE_BANNER:</span><br><span class="line">      <span class="keyword">return</span> state.set(<span class="string">"bannerList"</span>, action.data);</span><br><span class="line">    <span class="keyword">case</span> actionTypes.CHANGE_RECOMMEND_LIST:</span><br><span class="line">      <span class="keyword">return</span> state.set(<span class="string">"recommendList"</span>, action.data);</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<h3 id="24-收工"><a href="#24-收工" class="headerlink" title="24 . 收工"></a>24 . 收工</h3><p>经历了刀山火海，海枯石烂，来到了最后一步渲染recommendList</p>
<p>recommend 下 index.js, 这里面首先在mapStateToProps和 mapDispatchToProps加上相应的数据，props解构state和action方法，传给RecommendList组件(突然发现这里还有个组件😂)<br>不过这个组件没有什么别的操作，仅仅只是拿到recommend给的数据然后渲染，这个代码就不贴了，三元github上有完整的项目代码</p>
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">"./store/actionCreators"</span>;</span><br><span class="line"><span class="keyword">import</span> Slider <span class="keyword">from</span> <span class="string">"../../components/slider/"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Content &#125; <span class="keyword">from</span> <span class="string">"./style"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; forceCheck &#125; <span class="keyword">from</span> <span class="string">'react-lazyload'</span>;</span><br><span class="line"><span class="keyword">import</span> Scroll <span class="keyword">from</span> <span class="string">'../../baseUI/scroll/index'</span>;</span><br><span class="line"><span class="keyword">import</span> RecommendList <span class="keyword">from</span> <span class="string">'../../components/list/'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Recommend</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; bannerList, recommendList &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> &#123; getBannerDataDispatch, getRecommendListDataDispatch &#125; = props;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!bannerList.size) &#123;</span><br><span class="line">      getBannerDataDispatch();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!recommendList.size)&#123;</span><br><span class="line">      getRecommendListDataDispatch();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> bannerListJS = bannerList ? bannerList.toJS() : [];</span><br><span class="line">  <span class="keyword">const</span> recommendListJS = recommendList ? recommendList.toJS() :[];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Content&gt;</span><br><span class="line">       &lt;Scroll className=<span class="string">"list"</span> onScroll=&#123;forceCheck&#125;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Slider bannerList=&#123;bannerListJS&#125;&gt;&lt;<span class="regexp">/Slider&gt;</span></span><br><span class="line"><span class="regexp">        &lt;RecommendList recommendList=&#123;recommendListJS&#125;&gt;&lt;/</span>RecommendList&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Scroll&gt;</span><br><span class="line">    &lt;<span class="regexp">/Content&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 映射Redux全局的state到组件的props上</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ recommend bannerList  是对象路径，在recommend.recommendList</span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; (&#123;</span></span><br><span class="line"><span class="regexp">  bannerList: state.getIn(["recommend", "bannerList"]),</span></span><br><span class="line"><span class="regexp">  recommendList: state.getIn(['recommend', 'recommendList']),</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 映射dispatch到props上</span></span><br><span class="line"><span class="regexp">const mapDispatchToProps = (dispatch) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    getBannerDataDispatch() &#123;</span></span><br><span class="line"><span class="regexp">      dispatch(actionTypes.getBannerList());</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    getRecommendListDataDispatch() &#123;</span></span><br><span class="line"><span class="regexp">      dispatch(actionTypes.getRecommendList());</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 将ui组件包装成容器组件</span></span><br><span class="line"><span class="regexp">export default connect(</span></span><br><span class="line"><span class="regexp">  mapStateToProps,</span></span><br><span class="line"><span class="regexp">  mapDispatchToProps</span></span><br><span class="line"><span class="regexp">)(React.memo(Recommend));</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>
最后我们就可以看到了这个效果，上下拉动的过程你会发现，纵享丝滑~

<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93b70da5c77640c8b0eb118573a5628b~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="25-啦吧啦吧"><a href="#25-啦吧啦吧" class="headerlink" title="25. 啦吧啦吧"></a>25. 啦吧啦吧</h2><p> 相信看到最后的伙伴肯定有所收获，如果对源码感兴趣，这里有 三元项目的<a href="https://github.com/sanyuan0704/react-cloud-music" target="_blank" rel="noopener">github源码</a>,当然，如果想要深入学习这个项目，三元还有个<br> <a href="https://juejin.im/book/6844733816460804104/section/6844733816506941448" target="_blank" rel="noopener">小册</a>。同时，这里还有一个完整的项目演示 <a href="http://47.98.159.95:8010/#/recommend" target="_blank" rel="noopener">地址</a>。</p>
<p> 最后的最后，如果写的不好的地方，欢迎指正，有不清楚的地方也欢迎提问~</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">GETAGGT IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/home/tags/react/" rel="tag">react</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">FRÜHER</span>
                    </a>
            </li>
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <span class="hide-xs hide-sm text-small icon-mr">NÄCHSTER</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"
                    title="Teilen auf Facebook"
                    aria-label="Teilen auf Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"
                    title="Teilen auf Twitter"
                    aria-label="Teilen auf Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"
                    title="Teilen auf Google Plus"
                    aria-label="Teilen auf Google Plus"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 花生. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">FRÜHER</span>
                    </a>
            </li>
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <span class="hide-xs hide-sm text-small icon-mr">NÄCHSTER</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"
                    title="Teilen auf Facebook"
                    aria-label="Teilen auf Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"
                    title="Teilen auf Twitter"
                    aria-label="Teilen auf Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"
                    title="Teilen auf Google Plus"
                    aria-label="Teilen auf Google Plus"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"
                        aria-label="Teilen auf Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Teilen auf Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"
                        aria-label="Teilen auf Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Teilen auf Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=http://yoursite.com/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/"
                        aria-label="Teilen auf Google Plus"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Teilen auf Google Plus</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">花生</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/home/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/home/assets/js/script-ovvcdc2zshcgmnoygpfc4diwhecdgn64ecj61f7kqzolk5srp0ggnj9uxuhl.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
