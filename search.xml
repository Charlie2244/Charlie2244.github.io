<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>react hooks 神三元项目解析</title>
    <url>/home/2020/08/08/react_hooks%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb214c8eefa047f6ac59cafad10b8428~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="吧啦吧啦"><a href="#吧啦吧啦" class="headerlink" title="吧啦吧啦"></a>吧啦吧啦</h2><p>&nbsp;&nbsp;&nbsp;&nbsp; 自从弄懂了神三元大神的作品《云音悦》，整个人神清气爽，飘飘欲仙~，本着学习应该共同进步的精神，我将三元项目的一个页面流程进行了一个细致的讲解。是的，你没有听错，是流程。我相信有很多人拿到一个开源项目希望能够弄懂，但是一个项目肯定是很大的，不知从何下手，每个组件与每个组件之间有着千丝万缕的联系，于是，想想还是算了吧。<br> <a id="more"></a><br>&nbsp;&nbsp;&nbsp;&nbsp; 在这里我将从零开始搭建这个项目，一步一步的将项目的真面目露出来，需要说明的是，我在这里仅仅只是对三元项目的代码进行了 cv大战(粘贴复制)，当然cv不是说每个文件一次性全部复制，而是有选择性的将流程能够走通。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; 如下图就是我们要完成的一个页面，其他的页面也是类似，完成这个页面其实能说明很多问题了，这个页面有从后端请求数据，有redux管理数据，有轮播图。。。 不多说了，进入正题吧!</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe073fc746284b9889f0853fbce28886~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><ul>
<li>react </li>
<li>styled.components 使得css在js文件可以书写</li>
<li>hooks  react新特性</li>
<li>redux  状态管理</li>
<li>immutable  优化性能</li>
<li>better-scroll  一个比较好的滚动下拉组件</li>
<li>react-router-config  将路由全部统一管理<blockquote style="color:black;background:#f8f8f8">
注意: 这些知识点你都要掌握(至少要了解他们是什么)，不然食起来可能会有点痛苦哦~
</blockquote>
## 项目目录结构

</li>
</ul>
<details style="background:#d0edf5"> 
<summary>目录</summary>

<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fed20cb2352429d8bac4cd82516ad11~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
</details>

<p>src</p>
<ul>
<li><p>api 前后端数据接口 以及一些配置文件</p>
</li>
<li><p>application 页面组件以及每个组件的store</p>
</li>
<li><p>assets 静态资源目录，主要放iconfonts以及全局样式</p>
</li>
<li><p>baseUI 功能性组件 如 加载组件 滚动条等</p>
</li>
<li><p>components 公共组件 如轮播图</p>
</li>
<li><p>layouts 涉及到路由,组件嵌套</p>
</li>
<li><p>routes  路由，使用react-router-config</p>
</li>
<li><p>store 全局 redux 仓库</p>
<h2 id="开始工作"><a href="#开始工作" class="headerlink" title="开始工作"></a>开始工作</h2><h3 id="1-配置路由"><a href="#1-配置路由" class="headerlink" title="1. 配置路由"></a>1. 配置路由</h3><p>src下创建 routes 文件夹 建index.js文件</p>
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code >
import React, { lazy, Suspense } from "react";
import { Redirect } from "react-router-dom";
import HomeLayout from "../layouts/HomeLayout";
import BlankLayout from "../layouts/BlankLayout";

<p>// 路由懒加载<br>const SuspenseComponent = Component =&gt; props =&gt; {<br>  return (</p>
<pre><code>&lt;Suspense fallback={null}&gt;
  &lt;Component {...props}&gt;&lt;/Component&gt;
&lt;/Suspense&gt;</code></pre><p>  )<br>}<br>// 组件懒加载<br>const RecommendComponent = lazy(() =&gt; import(“../application/Recommend/“));</p>
<p>export default [<br>  {</p>
<pre><code>component: BlankLayout,
routes: [
  {
    path: &quot;/&quot;,
    component: HomeLayout,
    routes: [
      {
        path: &quot;/&quot;,
        exact: true,
        render: () =&gt; &lt;Redirect to={&quot;/recommend&quot;} /&gt;,
      },
      {
        path: &quot;/recommend&quot;,
        component:  SuspenseComponent(RecommendComponent),
      },
    ],
  },
],</code></pre><p>  },<br>];<br></code></pre></p>
</details>

</li>
</ul>
<p>这种配置路由的方式与之前普通的区别可能有点大，不了解的建议充个电(react-router-config) <br/><br>在这里BlankLayout是全局组件，在它下面放置所有路由级别组件，HomeLayout下所有路由级别组件也都归HomeLayout管理，这里我们看到的只有recommend组件，这也就是<code style="color:red;">逐级嵌套</code>。所有的路由都放在这里统一管理，之前普通路由是哪个组件需要路由才到哪个组件下面写，管理不方便。</p>
<h3 id="2-创建layouts文件夹"><a href="#2-创建layouts文件夹" class="headerlink" title="2. 创建layouts文件夹"></a>2. 创建layouts文件夹</h3><p>建 BlankLayout.js 以及 HomeLayout.js<br/><br> &nbsp;&nbsp; BlankLayout.js下是全局组件，HomeLayout下放的是recommend singers,rank 三大组件，由于整个项目过多，这里我们只介绍recommend页面，当然，如果recommend页面会写了，那么其他页面其实都是类似的操作</p>
<details style="background:#d0edf5"> 
<summary>BlankLayout.js</summary>
<pre><code>
  import React from "react";
  import { renderRoutes } from "react-router-config";
  // 从我们刚刚配置的路由可知 这个组件是最外层组件 所有路由级别组件都在这
  const Layout = ({ route }) => <>{renderRoutes(route.routes)}</>;
  export default Layout
</code></pre>
</details>
<br/>
<details  style="background:#d0edf5"> 
<summary>HomeLayout.js</summary>

<pre><code>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; renderRoutes &#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; route &#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;<span class="comment">/* 将HomeLayout的子组件都放到这里 */</span>&#125;</span><br><span class="line">      &#123;renderRoutes(route.routes)&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default React.memo(Home);</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>
可以看到这样用到了 renderRoutes,根据 routes 里面的内容，HomeLayout 是 BlankLayout 子路由，并且在 BlankLayout 下面有子路由 recommend, 所以将renderRoutes放在 HomeLayout 下面。(route)

<h3 id="3-创建application目录"><a href="#3-创建application目录" class="headerlink" title="3. 创建application目录"></a>3. 创建application目录</h3><p>创建Recommend子目录,Recomend下创建index.js</p>
<details style="background:#d0edf5">
<summary>index.js</summary>

<p>  <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b38247c98864367a768f858f2241faa~tplv-k3u1fbpfcp-zoom-1.image" alt=""> </p>
</details>


<p>现在还不能运行，因为在app.js中没有导入路由(由于div会被编辑器吃掉😂，某些地方只能上图片)</p>
<h3 id="4-来到App-js"><a href="#4-来到App-js" class="headerlink" title="4. 来到App.js"></a>4. 来到App.js</h3><details style="background:#d0edf5;"> 
<summary>App.js</summary>
<pre><code >
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line">    <span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">"./routes/index.js"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; renderRoutes &#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; HashRouter &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">          &lt;HashRouter&gt;</span><br><span class="line">            &#123;renderRoutes(routes)&#125;</span><br><span class="line">          &lt;<span class="regexp">/HashRouter&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    export default App;</span></span><br><span class="line"><span class="regexp">    ```	</span></span><br><span class="line"><span class="regexp">&lt;/</span>code&gt;&lt;<span class="regexp">/pre&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>details&gt;</span><br><span class="line"></span><br><span class="line">我们将 routes里面的文件导入到了renderRoutes,renderRoutes就可以根据routes里面的组件在其他组件下放入其他组件了(就问你绕不绕，此其他非彼其他🤔)。这个理解了其实用起来感觉会很方便。</span><br><span class="line">到这我们安装两个包</span><br><span class="line"><span class="string">``</span><span class="string">`js</span></span><br><span class="line"><span class="string">yarn add react-router-config</span></span><br><span class="line"><span class="string">yarn add react-router-dom</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>	</span><br><span class="line">这个时候项目就可以运行起来了</span><br><span class="line">运行结果如下</span><br><span class="line">![](https:<span class="comment">//p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e34411e98093472aa5cb96792b861a35~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line">### 5. 配置 global-style.js 文件 以及全局样式</span><br><span class="line">src下创建 assets目录，创建该文件，该文件是通用样式文件(不要与全局样式混淆)，比如，该app的主题颜色(你懂的颜色)在许多地方都会用到</span><br><span class="line">&lt;details style=<span class="string">"background:#d0edf5"</span>&gt;</span><br><span class="line">&lt;summary&gt;global-style.js&lt;<span class="regexp">/summary&gt;</span></span><br><span class="line"><span class="regexp">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="regexp">    ```js</span></span><br><span class="line"><span class="regexp">    const extendClick = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      return `</span></span><br><span class="line"><span class="regexp">        position: relative;</span></span><br><span class="line"><span class="regexp">        &amp;:before&#123;</span></span><br><span class="line"><span class="regexp">          content: '';</span></span><br><span class="line"><span class="regexp">          position: absolute;</span></span><br><span class="line"><span class="regexp">          top: -10px; bottom: -10px; left: -10px; right: -10px;</span></span><br><span class="line"><span class="regexp">        &#125;;</span></span><br><span class="line"><span class="regexp">      `;</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    const noWrap = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      return `</span></span><br><span class="line"><span class="regexp">        text-overflow: ellipsis;</span></span><br><span class="line"><span class="regexp">        overflow: hidden;</span></span><br><span class="line"><span class="regexp">        white-space: nowrap;</span></span><br><span class="line"><span class="regexp">      `;</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    const bgFull = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      return `</span></span><br><span class="line"><span class="regexp">        background-position: 50%;</span></span><br><span class="line"><span class="regexp">        background-size: contain;</span></span><br><span class="line"><span class="regexp">        background-repeat: no-repeat;</span></span><br><span class="line"><span class="regexp">      `</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    export default &#123;</span></span><br><span class="line"><span class="regexp">      "theme-color": "#d44439", /</span><span class="regexp">/今天有绿吗</span></span><br><span class="line"><span class="regexp">      "theme-color-shadow": "rgba(212, 68, 57, .5)",</span></span><br><span class="line"><span class="regexp">      "font-color-light": "#f1f1f1",</span></span><br><span class="line"><span class="regexp">      "font-color-light-shadow": "rgba(241, 241, 241, 0.6)",/</span><span class="regexp">/略淡</span></span><br><span class="line"><span class="regexp">      "font-color-desc": "#2E3030",</span></span><br><span class="line"><span class="regexp">      "font-color-desc-v2": "#bba8a8", /</span><span class="regexp">/略淡</span></span><br><span class="line"><span class="regexp">      "font-size-ss": "10px",</span></span><br><span class="line"><span class="regexp">      "font-size-s": "12px",</span></span><br><span class="line"><span class="regexp">      "font-size-m": "14px",</span></span><br><span class="line"><span class="regexp">      "font-size-l": "16px",</span></span><br><span class="line"><span class="regexp">      "font-size-ll": "18px",</span></span><br><span class="line"><span class="regexp">      "border-color": "#e4e4e4",</span></span><br><span class="line"><span class="regexp">      "border-color-v2": "rgba(228, 228, 228, 0.1)",</span></span><br><span class="line"><span class="regexp">      "background-color": "#f2f3f4",</span></span><br><span class="line"><span class="regexp">      "background-color-shadow": "rgba(0, 0, 0, 0.3)",</span></span><br><span class="line"><span class="regexp">      "highlight-background-color": "#fff",</span></span><br><span class="line"><span class="regexp">      "official-red": "#E82001",</span></span><br><span class="line"><span class="regexp">      extendClick,</span></span><br><span class="line"><span class="regexp">      noWrap,</span></span><br><span class="line"><span class="regexp">      bgFull</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">    ```	</span></span><br><span class="line"><span class="regexp">&lt;/</span>code&gt;&lt;<span class="regexp">/pre&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>details&gt;</span><br><span class="line">全局样式，这个样式不仅仅在这里可以用到，其他的项目同样可以引入</span><br><span class="line">&lt;details style=<span class="string">"background:#d0edf5"</span>&gt;</span><br><span class="line">&lt;summary&gt;style.js&lt;<span class="regexp">/summary&gt;</span></span><br><span class="line"><span class="regexp">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="regexp">    ```js</span></span><br><span class="line"><span class="regexp">    import &#123; createGlobalStyle &#125; from 'styled-components'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    export const GlobalStyle = createGlobalStyle`</span></span><br><span class="line"><span class="regexp">        html, body, div, span, applet, object, iframe,</span></span><br><span class="line"><span class="regexp">        h1, h2, h3, h4, h5, h6, p, blockquote, pre,</span></span><br><span class="line"><span class="regexp">        a, abbr, acronym, address, big, cite, code,</span></span><br><span class="line"><span class="regexp">        del, dfn, em, img, ins, kbd, q, s, samp,</span></span><br><span class="line"><span class="regexp">        small, strike, strong, sub, sup, tt, var,</span></span><br><span class="line"><span class="regexp">        b, u, i, center,</span></span><br><span class="line"><span class="regexp">        dl, dt, dd, ol, ul, li,</span></span><br><span class="line"><span class="regexp">        fieldset, form, label, legend,</span></span><br><span class="line"><span class="regexp">        table, caption, tbody, tfoot, thead, tr, th, td,</span></span><br><span class="line"><span class="regexp">        article, aside, canvas, details, embed, </span></span><br><span class="line"><span class="regexp">        figure, figcaption, footer, header, hgroup, </span></span><br><span class="line"><span class="regexp">        menu, nav, output, ruby, section, summary,</span></span><br><span class="line"><span class="regexp">        time, mark, audio, video &#123;</span></span><br><span class="line"><span class="regexp">            margin: 0;</span></span><br><span class="line"><span class="regexp">            padding: 0;</span></span><br><span class="line"><span class="regexp">            border: 0;</span></span><br><span class="line"><span class="regexp">            font-size: 100%;</span></span><br><span class="line"><span class="regexp">            font: inherit;</span></span><br><span class="line"><span class="regexp">            vertical-align: baseline;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        /</span>* HTML5 display-role reset <span class="keyword">for</span> older browsers *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">        article, aside, details, figcaption, figure, </span></span><br><span class="line"><span class="regexp">        footer, header, hgroup, menu, nav, section &#123;</span></span><br><span class="line"><span class="regexp">            display: block;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        body &#123;</span></span><br><span class="line"><span class="regexp">            line-height: 1;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        html, body&#123;</span></span><br><span class="line"><span class="regexp">            background: #f2f3f4;;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        ol, ul &#123;</span></span><br><span class="line"><span class="regexp">            list-style: none;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        blockquote, q &#123;</span></span><br><span class="line"><span class="regexp">            quotes: none;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        blockquote:before, blockquote:after,</span></span><br><span class="line"><span class="regexp">        q:before, q:after &#123;</span></span><br><span class="line"><span class="regexp">            content: '';</span></span><br><span class="line"><span class="regexp">            content: none;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        table &#123;</span></span><br><span class="line"><span class="regexp">            border-collapse: collapse;</span></span><br><span class="line"><span class="regexp">            border-spacing: 0;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        a&#123;</span></span><br><span class="line"><span class="regexp">            text-decoration: none;</span></span><br><span class="line"><span class="regexp">            color: #fff;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    `</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>


<h3 id="6-开始写头部"><a href="#6-开始写头部" class="headerlink" title="6. 开始写头部"></a>6. 开始写头部</h3><p>这里我们将用到 比较新的知识<code style="color:red;">styled.components</code>以及需要<code style="color:red;">iconfont</code> , 来到HomeLayout下，</p>
<details style="background:#d0edf5">
<summary>HomeLayout.js</summary>

<p>   <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74e5ded5340f4cdf8a1cfb03661ad694~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
</details>

<p>这里我们导入了HomeLayout.style.js(styled.componets)以及<code style="color:red;"> &#xe65c;</code>(iconfont)，未加iconfont类似于‘口’，因此我们需要创建它们。styled.components就类似于在js文件里面写样式，并且该容器的class会随机生成。<br>从如下代码我们可以看到Top就是一个容器，它的子容器的样式也可以在这里写，然后导入上面的HomeLayout.js.</p>
<h3 id="7-在同级目录下创建HomeLayout-style-js"><a href="#7-在同级目录下创建HomeLayout-style-js" class="headerlink" title="7. 在同级目录下创建HomeLayout.style.js"></a>7. 在同级目录下创建HomeLayout.style.js</h3><details style="background:#d0edf5">
<summary>HomeLayout.style.js</summary>
<pre><code>
     <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">"styled-components"</span>;</span><br><span class="line">    <span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">"../assets/global-style"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> Top = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      flex-direction: row;</span></span><br><span class="line"><span class="string">      justify-content: space-between;</span></span><br><span class="line"><span class="string">      padding: 5px 10px;</span></span><br><span class="line"><span class="string">      background: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">      &amp; &gt; span &#123;</span></span><br><span class="line"><span class="string">        line-height: 40px;</span></span><br><span class="line"><span class="string">        color: #f1f1f1;</span></span><br><span class="line"><span class="string">        font-size: 20px;</span></span><br><span class="line"><span class="string">        &amp;.iconfont &#123;</span></span><br><span class="line"><span class="string">          font-size: 25px;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    <span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">&lt;/code&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">将这段代码引入之后就可以看到效果了</span></span><br><span class="line"><span class="string">此时运行结果如下</span></span><br><span class="line"><span class="string">![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/db7f42236a704b67b688b32e12d05ba1~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string">因为还没有配置iconfont,所以是如上效果</span></span><br><span class="line"><span class="string">### 8. 配置iconfont</span></span><br><span class="line"><span class="string">可以到icontfont官网下载所需要的文件，放在assets目录下，目录如下</span></span><br><span class="line"><span class="string">![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be6982fc567b44fbb4bc65dd33c40730~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string">在全局App.js引入icontfont文件，加上这几行代码</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> &#123; IconStyle &#125; <span class="keyword">from</span> <span class="string">"./assets/iconfont/iconfont"</span>;</span><br><span class="line">&lt;HashRouter&gt;</span><br><span class="line">   &lt;IconStyle&gt;&lt;<span class="regexp">/IconStyle&gt;</span></span><br><span class="line"><span class="regexp">   &#123;renderRoutes(routes)&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>HashRouter&gt;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">运行效果如下，图标出来了</span></span><br><span class="line"><span class="string">![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e026c85b69742a0b092451a1c3ea771~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string">### 9. 接着在 HomeLayout.js 写布局</span></span><br><span class="line"><span class="string">在原来的的基础上加上如下代码&lt;Top&gt;下面写</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt;</span></span><br><span class="line"><span class="string">&lt;summary&gt;HomeLayout.js&lt;/summary&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7903bf78b8da4471ac8759c6dc832ee1~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string">这里我们用NavLink指向了三个路由地址，我们目前只做recommend</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">上面引入了 &lt;Tab&gt;&lt;TabItem&gt;,在HomeLayout.style.js写</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt;</span></span><br><span class="line"><span class="string">&lt;summary&gt;HomeLayout.style.js&lt;/summary&gt;</span></span><br><span class="line"><span class="string">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="string">    `</span><span class="string">``</span>js</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> Tab = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">      height: 44px;</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      flex-direction: row;</span></span><br><span class="line"><span class="string">      justify-content: space-around;</span></span><br><span class="line"><span class="string">      background: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">      a &#123;</span></span><br><span class="line"><span class="string">        flex: 1;</span></span><br><span class="line"><span class="string">        padding: 2px 0;</span></span><br><span class="line"><span class="string">        font-size: 14px;</span></span><br><span class="line"><span class="string">        color: #e4e4e4;</span></span><br><span class="line"><span class="string">        &amp;.selected &#123;</span></span><br><span class="line"><span class="string">          span &#123;</span></span><br><span class="line"><span class="string">            padding: 3px 0;</span></span><br><span class="line"><span class="string">            font-weight: 700;</span></span><br><span class="line"><span class="string">            color: #f1f1f1;</span></span><br><span class="line"><span class="string">            border-bottom: 2px solid #f1f1f1;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> TabItem = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">      height: 100%;</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      flex-direction: row;</span></span><br><span class="line"><span class="string">      justify-content: center;</span></span><br><span class="line"><span class="string">      align-items: center;</span></span><br><span class="line"><span class="string">    `</span>;</span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>页面结果如下<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b730a1c6138498bb924dc87781220f9~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h3 id="10-来到了难点重点部分。"><a href="#10-来到了难点重点部分。" class="headerlink" title="10. 来到了难点重点部分。"></a>10. 来到了难点重点部分。</h3><p>前面的都是一些基础的不需要从后端获取数据就可以完成的，但是接下来的内容轮播图，以及列表都是需要从后端接口请求数据渲染到页面。<br>数据拿到了也需要人来管理，那么谁呢，就是你又爱又恨的<code style="color:red;">redux</code>。<br/><br>接下来首先得准备好接口数据<br>src下创建api文件夹，在该文件夹下配置<code style="color:red;">config.js</code>文件， 该文件一般是用来配置默认后端请求接口路径</p>
<details style="background:#d0edf5">
<summary>config.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> baseUrl = <span class="string">"http://neteasecloudmusicapi.zhaoboy.com"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个axios的实例及拦截器配置</span></span><br><span class="line">    <span class="keyword">const</span> axiosInstance = axios.create(&#123;</span><br><span class="line">      baseURL: baseUrl</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 响应拦截器，在获取响应之前处理数据</span></span><br><span class="line">    axiosInstance.interceptors.response.use(</span><br><span class="line">      res =&gt; res.data,</span><br><span class="line">      err =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err, <span class="string">"网络错误"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> &#123; axiosInstance &#125;;</span><br><span class="line">    <span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">&lt;/code&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 11. 同路径api下创建request.js</span></span><br><span class="line"><span class="string">该文件用来封装 请求接口，通过调用该函数可以请求数据</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> &#123; axiosInstance &#125; <span class="keyword">from</span> <span class="string">"./config"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getBannerRequest = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> axiosInstance.get(<span class="string">"/banner"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">### 12. 创建redux 仓库</span></span><br><span class="line"><span class="string">需要说明的是，神三元项目中每个对应的路由组件都有一个store,然后将所有的store(该store中没有store文件，一个项目只应该有一个仓库)全部引入到最外面的store，这样写的理由是逻辑清晰。如果不这样写很多action放到一起，很多reducer放到一起，文件数量可能会较大，头都大了。&lt;br/&gt;</span></span><br><span class="line"><span class="string">那么用redux怎么管理数据呢？简单说就是dispatch(action)向store请求数据，store又找reducer,reducer对请求的数据进行一定的操作，存到store,在组件中connect一下，再通过props获取数据</span></span><br><span class="line"><span class="string">![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ebdeb84be27e4f5aa2cbae6373e178e2~tplv-k3u1fbpfcp-zoom-1.image)</span></span><br><span class="line"><span class="string">我们在Recommend下创建store文件夹，分别创建     </span></span><br><span class="line"><span class="string">&lt;code style="color:red;"&gt;constants.js&lt;/code&gt;</span></span><br><span class="line"><span class="string">&lt;code style="color:red;"&gt;actionCreators.js&lt;/code&gt;</span></span><br><span class="line"><span class="string">&lt;code style="color:red;"&gt;reducer.js&lt;/code&gt;</span></span><br><span class="line"><span class="string">&lt;code style="color:red;"&gt;index.js&lt;/code&gt;</span></span><br><span class="line"><span class="string">#### 12.1 constants.js</span></span><br><span class="line"><span class="string">该文件只有一行代码，作用是区分不同的actions </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_BANNER = <span class="string">'home/recommend/CHANGE_BANNER'</span>;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 12.2 actionCreators.js </span></span><br><span class="line"><span class="string">该文件中有 changeBannerList 用来改变状态，也就是传进来什么数据就修改成什么数据，但是为了支持异步，我们需要通过下面一个getBannerList来获取数据</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt; </span></span><br><span class="line"><span class="string">&lt;summary&gt;actionCreators.js&lt;/summary&gt;</span></span><br><span class="line"><span class="string">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="string">     `</span><span class="string">``</span>js</span><br><span class="line">    <span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; getBannerRequest &#125; <span class="keyword">from</span> <span class="string">'../../../api/request'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> changeBannerList = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123;</span><br><span class="line">      type: actionTypes.CHANGE_BANNER,</span><br><span class="line">      data: fromJS(data)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 获取 轮播图数据</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> getBannerList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">        getBannerRequest().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> action = changeBannerList(data.banners);</span><br><span class="line">          dispatch(action);</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"轮播图数据传输错误"</span>);</span><br><span class="line">        &#125;) </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">&lt;/code&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意，我们在这里使用了immutable,以后的文件会大量用到immutable,简单介绍下作用: 使用旧数据创建新数据时可以保证新数据不变，并且创建新数据的过程中使用了结构共享，如下图所示</span></span><br><span class="line"><span class="string">![](https://user-gold-cdn.xitu.io/2018/4/4/1628e77dc419816b?imageslim)</span></span><br><span class="line"><span class="string">在上面的代码中我们导入getBannerRequest的请求，getBannerList 返回的是一个方法，我们需要在store导入redux-thunk包,这是后面写到的。&lt;br/&gt;</span></span><br><span class="line"><span class="string">#### 12.3 reducer.js</span></span><br><span class="line"><span class="string">reducer.js 首先初始化bannerList的数据，然后switch一顿狂操作</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt; </span></span><br><span class="line"><span class="string">&lt;summary&gt;reducer.js&lt;/summary&gt;</span></span><br><span class="line"><span class="string">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="string">    `</span><span class="string">``</span>js</span><br><span class="line">    <span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> defaultState = fromJS(&#123;</span><br><span class="line">      bannerList: [],</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> (state = defaultState, action) =&gt; &#123;</span><br><span class="line">      <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> actionTypes.CHANGE_BANNER:</span><br><span class="line">          <span class="keyword">return</span> state.set(<span class="string">'bannerList'</span>, action.data);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">return</span> state;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">&lt;/code&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&lt;/details&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 12.4 index.js</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'./actionCreators'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">'./constants'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer, actionCreators, constants &#125;;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">将三个文件整合，并导出</span></span><br><span class="line"><span class="string">以上是Recommend 里面的store,(再次说明: 里面的store是没有仓库的，统一放到外面的仓库管理)，我们需要创建 外面最大的store</span></span><br><span class="line"><span class="string">### 13. 在src 创建 store文件夹(最外面的仓库)</span></span><br><span class="line"><span class="string">store 下创建 reducer.js 集合所有reducer, index.js 仓库</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">reducer.js</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">"redux-immutable"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reducer <span class="keyword">as</span> recommendReducer &#125; <span class="keyword">from</span> <span class="string">"../application/Recommend/store/index"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">  recommend: recommendReducer,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">index.js, 这里我们安装了 redux-thunk,支持action返回方法</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">import</span> &#123; createStore, compose, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">"redux-thunk"</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducer"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> composeEnhancers = <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, composeEnhancers(applyMiddleware(thunk)));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string">14. 在App.js 引入store,使之成为全局仓库</span></span><br><span class="line"><span class="string">现在App.js文件长这样</span></span><br><span class="line"><span class="string">&lt;details style="background:#d0edf5"&gt; </span></span><br><span class="line"><span class="string">&lt;summary&gt;代码&lt;/summary&gt;</span></span><br><span class="line"><span class="string">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="string">    `</span><span class="string">``</span>js</span><br><span class="line">    <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line">    <span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">"./routes/index.js"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; renderRoutes &#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; HashRouter &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; IconStyle &#125; <span class="keyword">from</span> <span class="string">"./assets/iconfont/iconfont"</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store/index"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">          &lt;HashRouter&gt;</span><br><span class="line">            &lt;IconStyle&gt;&lt;<span class="regexp">/IconStyle&gt;</span></span><br><span class="line"><span class="regexp">            &#123;renderRoutes(routes)&#125;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>HashRouter&gt;</span><br><span class="line">        &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    export default App;</span></span><br><span class="line"><span class="regexp">    ```	</span></span><br><span class="line"><span class="regexp">&lt;/</span>code&gt;&lt;<span class="regexp">/pre&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>details&gt;</span><br><span class="line"></span><br><span class="line">需要导入一个Provider，使得全局都可以使用store里面的数据</span><br><span class="line">到这里我们终于把Recommend的数据管理给搞定了，下载必要的包</span><br><span class="line">yarn add axios redux react-reudx immutable redux-immutable redux-thunk (可能不全)</span><br><span class="line">接下里就是如何将数据渲染到页面了。</span><br><span class="line"></span><br><span class="line">### 15. 来到HomeLayout的子组件Recommend下的 index.js 中</span><br><span class="line">首先我们先通过connect拿到数据</span><br><span class="line">&lt;details style=<span class="string">"background:#d0edf5"</span>&gt; </span><br><span class="line">&lt;summary&gt;index.js&lt;<span class="regexp">/summary&gt;</span></span><br><span class="line"><span class="regexp">&lt;pre&gt;&lt;code&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">![](https:/</span><span class="regexp">/p9-juejin.byteimg.com/</span>tos-cn-i-k3u1fbpfcp/<span class="number">4</span>b9db461c6ae4473ac4e8b4bafef023e~tplv-k3u1fbpfcp-zoom<span class="number">-1.</span>image)</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/code&gt;&lt;/</span>pre&gt;</span><br><span class="line">&lt;<span class="regexp">/details&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">connect 之后怎么拿数据呢？ 通过props可以获取数据，接下来我们来写如何通过props获取数据</span></span><br><span class="line"><span class="regexp">&lt;details style="background:#d0edf5"&gt; </span></span><br><span class="line"><span class="regexp">&lt;summary&gt;index.js&lt;/</span>summary&gt;</span><br><span class="line">&lt;pre&gt;<span class="xml"><span class="tag">&lt;<span class="name">code</span>&gt;</span></span></span><br><span class="line"><span class="xml">```js</span></span><br><span class="line"><span class="xml">    function Recommend(props) &#123;</span></span><br><span class="line"><span class="xml">      const &#123; bannerList&#125; = props;</span></span><br><span class="line"><span class="xml">      const &#123; getBannerDataDispatch &#125; = props;</span></span><br><span class="line"><span class="xml">      useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">        if(!bannerList.size)&#123;</span></span><br><span class="line"><span class="xml">          getBannerDataDispatch();</span></span><br><span class="line"><span class="xml">          console.log(bannerList);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">      &#125;, []);</span></span><br><span class="line"><span class="xml">      return (</span></span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          Recommend</span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      )</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br></pre></td></tr></table></figure>

<p></code></pre></p>
</details>

<p>只要connect之后，我们就可以通过props拿到数据了，props之后解构刚刚上面的bannerList数据和getBannerDataDispatch方法，调用该方法之后就可以获取数据，所以我们把它放到useEffect,中，判断bannerList是否为空，不用每次执行都请求一次数据。打印之后我们可以看到如下结果<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cb087d9f61c41ad951e91be3ed40018~tplv-k3u1fbpfcp-zoom-1.image" alt=""><br>数据拿到了，现在要做轮播图，因为轮播图可能多个地方都会用到，所以我们将它放到components目录下</p>
<h3 id="16-创建slider"><a href="#16-创建slider" class="headerlink" title="16. 创建slider"></a>16. 创建slider</h3><p>在src下创建components文件夹，接着创建slider文件夹，在里面创建 index.js和style.js</p>
<p>style.js, 这是给swiper加的样式，引入了Global-style里面的主题颜色</p>
<details style="background:#d0edf5"> 
<summary>style.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'../../assets/global-style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SliderContainer = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  position: relative;</span></span><br><span class="line"><span class="string">  box-sizing: border-box;</span></span><br><span class="line"><span class="string">  width: 100%;</span></span><br><span class="line"><span class="string">  height: 100%;</span></span><br><span class="line"><span class="string">  margin: auto;</span></span><br><span class="line"><span class="string">  background: white;</span></span><br><span class="line"><span class="string">  .before&#123;</span></span><br><span class="line"><span class="string">    position: absolute;</span></span><br><span class="line"><span class="string">    top: -300px;</span></span><br><span class="line"><span class="string">    height: 400px;</span></span><br><span class="line"><span class="string">    width: 100%;</span></span><br><span class="line"><span class="string">    background: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">    z-index: 1;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  .slider-container&#123;</span></span><br><span class="line"><span class="string">    position: relative;</span></span><br><span class="line"><span class="string">    width: 98%;</span></span><br><span class="line"><span class="string">    height: 160px;</span></span><br><span class="line"><span class="string">    overflow: hidden;</span></span><br><span class="line"><span class="string">    margin: auto;</span></span><br><span class="line"><span class="string">    border-radius: 6px;</span></span><br><span class="line"><span class="string">    .slider-nav&#123;</span></span><br><span class="line"><span class="string">      position: absolute;</span></span><br><span class="line"><span class="string">      display: block;</span></span><br><span class="line"><span class="string">      width: 100%;</span></span><br><span class="line"><span class="string">      height: 100%;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    .swiper-pagination-bullet-active&#123;</span></span><br><span class="line"><span class="string">      background: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>
index.js
<details style="background:#d0edf5"> 
<summary>代码</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"swiper/swiper-bundle.min.css"</span>; <span class="comment">//这里引用的方式已经发生了变化</span></span><br><span class="line"><span class="keyword">import</span> Swiper <span class="keyword">from</span> <span class="string">"swiper"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SliderContainer &#125; <span class="keyword">from</span> <span class="string">'./style'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Slider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [sliderSwiper, setSliderSwiper] = useState(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; bannerList &#125; = props;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(bannerList.length &amp;&amp; !sliderSwiper)&#123;</span><br><span class="line">      <span class="keyword">let</span> sliderSwiper = <span class="keyword">new</span> Swiper(<span class="string">".slider-container"</span>, &#123;</span><br><span class="line">        loop: <span class="literal">true</span>,</span><br><span class="line">        autoplay: &#123;</span><br><span class="line">          delay: <span class="number">3000</span>,</span><br><span class="line">          disableOnInteraction: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        pagination: &#123;<span class="attr">el</span>:<span class="string">'.swiper-pagination'</span>&#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">      setSliderSwiper(sliderSwiper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;, [bannerList.length, sliderSwiper])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;SliderContainer&gt;</span><br><span class="line">       &lt;div className=<span class="string">"before"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">       &lt;div className="slider-container"&gt;</span></span><br><span class="line"><span class="regexp">       &lt;div className="swiper-wrapper"&gt;</span></span><br><span class="line"><span class="regexp">         &#123;</span></span><br><span class="line"><span class="regexp">           bannerList.map(slider =&gt; &#123;</span></span><br><span class="line"><span class="regexp">             return (</span></span><br><span class="line"><span class="regexp">              &lt;div className="swiper-slide" key=&#123;slider.imageUrl&#125;&gt;</span></span><br><span class="line"><span class="regexp">                 &lt;div className="slider-nav"&gt;</span></span><br><span class="line"><span class="regexp">                 &lt;img src=&#123;slider.imageUrl&#125; width="100%" height="100%" alt="推荐" /</span>&gt;</span><br><span class="line">                 &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">             )</span><br><span class="line">           &#125;)</span><br><span class="line">         &#125;</span><br><span class="line">       &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">       &lt;div className="swiper-pagination"&gt;&lt;/</span>div&gt;</span><br><span class="line">       &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>SliderContainer&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.memo(Slider);</span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>这里主要是使用了swiper api, 具体用法可以看<a href="https://www.swiper.com.cn/api/index.html" target="_blank" rel="noopener">swiper官网</a>有详细介绍</p>
<h3 id="17-导入slider"><a href="#17-导入slider" class="headerlink" title="17. 导入slider"></a>17. 导入slider</h3><p>swiper 写完了之后，来到，recommend 下的index.js, 首先为index.js写个style.js</p>
<details style="background:#d0edf5"> 
<summary>style.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Content = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    position: fixed;</span></span><br><span class="line"><span class="string">    top: 94px;</span></span><br><span class="line"><span class="string">    left: 0;</span></span><br><span class="line"><span class="string">    bottom: <span class="subst">$&#123;props =&gt; props.play &gt; <span class="number">0</span>?<span class="string">"60px"</span>: <span class="number">0</span>&#125;</span>;</span></span><br><span class="line"><span class="string">    width: 100%;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>在index.js中导入Slider</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Content &#125; <span class="keyword">from</span> <span class="string">"./style"</span>;</span><br><span class="line"><span class="keyword">import</span> Slider <span class="keyword">from</span> <span class="string">"../../components/slider/"</span>;</span><br><span class="line"> <span class="keyword">const</span> bannerListJS = bannerList ? bannerList.toJS() : [];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Content &gt;</span><br><span class="line">      &lt;div&gt;<span class="xml"><span class="tag">&lt;<span class="name">Slider</span> <span class="attr">bannerList</span>=<span class="string">&#123;bannerListJS&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Slider</span>&gt;</span></span>&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Content&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 index.js加上上面这几句代码之后就可以看到效果了,但是你会发现header被覆盖了，这里其实是 Slider组件里面的before搞的鬼， 如果要改过来也很简单，在它的父容器加个overflow:hidden就可以解决问题，但是现在因为我们要做滚动(需要上下可以滚动)，滚动会做slider的父容器，也会有overflow:hidden,所以这里就先不处理。<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f699119a0c646a48469b20202eebab5~tplv-k3u1fbpfcp-zoom-1.image" alt=""><br>但是我们发现这个轮播图是不能滚动的，因为我们现在用的swiper 是swiper6最新版本，具体的可以看官网如何使用</p>
<h3 id="18-loading组件"><a href="#18-loading组件" class="headerlink" title="18. loading组件"></a>18. loading组件</h3><p>讲解scroll组件又会牵扯到 loading 组件(加载)和 debounce函数(防抖)，所以得先建loading组件和防抖函数<br>baseUI文件下分别创建loading和loading-v2文件夹</p>
<p>loading中的文件</p>
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> styled, &#123; keyframes &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'../../assets/global-style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loading = keyframes<span class="string">`</span></span><br><span class="line"><span class="string">  0%, 100% &#123;</span></span><br><span class="line"><span class="string">    transform: scale(0.0);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  50% &#123;</span></span><br><span class="line"><span class="string">    transform: scale(1.0);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="keyword">const</span> LoadingWrapper = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    &gt;div &#123;</span></span><br><span class="line"><span class="string">      position: absolute;</span></span><br><span class="line"><span class="string">      top: 0; left: 0; right: 0; bottom: 0;</span></span><br><span class="line"><span class="string">      margin: auto;</span></span><br><span class="line"><span class="string">      width: 60px;</span></span><br><span class="line"><span class="string">      height: 60px;</span></span><br><span class="line"><span class="string">      opacity: 0.6;</span></span><br><span class="line"><span class="string">      border-radius: 50%;</span></span><br><span class="line"><span class="string">      background-color: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">      animation: <span class="subst">$&#123;loading&#125;</span> 1.4s infinite ease-in;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(2) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.7s;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params"></span>)  </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;LoadingWrapper&gt;</span><br><span class="line">      &lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/LoadingWrapper&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default React.memo(Loading);</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>
loading-v2中的文件
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> styled, &#123;keyframes&#125; <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'../../assets/global-style'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dance = keyframes<span class="string">`</span></span><br><span class="line"><span class="string">    0%, 40%, 100%&#123;</span></span><br><span class="line"><span class="string">      transform: scaleY(0.4);</span></span><br><span class="line"><span class="string">      transform-origin: center 100%;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    20%&#123;</span></span><br><span class="line"><span class="string">      transform: scaleY(1);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="keyword">const</span> Loading = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    height: 10px;</span></span><br><span class="line"><span class="string">    width: 100%;</span></span><br><span class="line"><span class="string">    margin: auto;</span></span><br><span class="line"><span class="string">    text-align: center;</span></span><br><span class="line"><span class="string">    font-size: 10px;</span></span><br><span class="line"><span class="string">    &gt;div&#123;</span></span><br><span class="line"><span class="string">      display: inline-block;</span></span><br><span class="line"><span class="string">      background-color: <span class="subst">$&#123;style[<span class="string">"theme-color"</span>]&#125;</span>;</span></span><br><span class="line"><span class="string">      height: 100%;</span></span><br><span class="line"><span class="string">      width: 1px;</span></span><br><span class="line"><span class="string">      margin-right:2px;</span></span><br><span class="line"><span class="string">      animation: <span class="subst">$&#123;dance&#125;</span> 1s infinite;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(2) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.4s;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(3) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.6s;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(4) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.5s;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &gt;div:nth-child(5) &#123;</span></span><br><span class="line"><span class="string">      animation-delay: -0.2s;</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingV2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Loading&gt;</span><br><span class="line">      &lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;&lt;/</span>div&gt;</span><br><span class="line">      &lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;&lt;/</span>div&gt;</span><br><span class="line">      &lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;拼命加载中...&lt;/</span>span&gt;</span><br><span class="line">    &lt;<span class="regexp">/Loading&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default React.memo(LoadingV2);</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>这两个文件都是用animation做的加载动画，具体就不介绍了，篇幅过长~</p>
<h3 id="19-debounce-函数"><a href="#19-debounce-函数" class="headerlink" title="19. debounce 函数"></a>19. debounce 函数</h3><p>防抖函数建在 api 的 utils.js 中<br>什么是防抖</p>
<p><strong><em>举个栗子：</em></strong>有个scroll事件，滚动会不停触发回滚动事件，从而调用绑定的回调函数，我们希望当我们停止滚动的时，才触发一次回调，这时可以使用函数防抖。</p>
<details style="background:#d0edf5"> 
<summary>代码</summary>
<pre><code>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> debounce = <span class="function">(<span class="params">func, delay</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(timer) &#123;</span><br><span class="line">      clearTimeout(timer);</span><br><span class="line">    &#125;</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      func.apply(<span class="keyword">this</span>, args);</span><br><span class="line">      clearTimeout(timer);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123; debounce &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</details>
这是三元写的原生js防抖函数，防抖原理就是第一次触发某个函数，在规定时间内如果再次触发就会重新计时。

<h3 id="20-scroll"><a href="#20-scroll" class="headerlink" title="20. scroll"></a>20. scroll</h3><p>好了，预备工作完成了，就可以写了，这里再说明一下，我现在是尽可能的帮助大家梳理如何能够看懂一个比较好的项目，实现可以自己动手实践</p>
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;</span><br><span class="line">  forwardRef,</span><br><span class="line">  useState,</span><br><span class="line">  useEffect,</span><br><span class="line">  useRef,</span><br><span class="line">  useImperativeHandle,</span><br><span class="line">  useMemo,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> BScroll <span class="keyword">from</span> <span class="string">"better-scroll"</span>;</span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">"styled-components"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debounce &#125; <span class="keyword">from</span> <span class="string">"../../api/utils"</span>;</span><br><span class="line"><span class="keyword">import</span> Loading <span class="keyword">from</span> <span class="string">'../loading/index'</span>;</span><br><span class="line"><span class="keyword">import</span> Loading2 <span class="keyword">from</span> <span class="string">'../loading-v2/index'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ScrollContainer = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  width: 100%;</span></span><br><span class="line"><span class="string">  height: 100%;</span></span><br><span class="line"><span class="string">  overflow: hidden;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PullUpLoading = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  position: absolute;</span></span><br><span class="line"><span class="string">  left: 0;</span></span><br><span class="line"><span class="string">  right: 0;</span></span><br><span class="line"><span class="string">  bottom: 5px;</span></span><br><span class="line"><span class="string">  width: 60px;</span></span><br><span class="line"><span class="string">  height: 60px;</span></span><br><span class="line"><span class="string">  margin: auto;</span></span><br><span class="line"><span class="string">  z-index: 100;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PullDownLoading = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  position: absolute;</span></span><br><span class="line"><span class="string">  left: 0;</span></span><br><span class="line"><span class="string">  right: 0;</span></span><br><span class="line"><span class="string">  top: 0px;</span></span><br><span class="line"><span class="string">  height: 30px;</span></span><br><span class="line"><span class="string">  margin: auto;</span></span><br><span class="line"><span class="string">  z-index: 100;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> Scroll = forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [bScroll, setBScroll] = useState();</span><br><span class="line">  <span class="keyword">const</span> scrollContaninerRef = useRef();</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    direction,</span><br><span class="line">    click,</span><br><span class="line">    refresh,</span><br><span class="line">    pullUpLoading,</span><br><span class="line">    pullDownLoading,</span><br><span class="line">    bounceTop,</span><br><span class="line">    bounceBottom,</span><br><span class="line">  &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> &#123; pullUp, pullDown, onScroll &#125; = props;</span><br><span class="line">  <span class="keyword">let</span> pullUpDebounce = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> debounce(pullUp, <span class="number">500</span>);</span><br><span class="line">  &#125;, [pullUp]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> pullDownDebounce = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> debounce(pullDown, <span class="number">500</span>);</span><br><span class="line">  &#125;, [pullDown]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> scroll = <span class="keyword">new</span> BScroll(scrollContaninerRef.current, &#123;</span><br><span class="line">      scrollX: direction === <span class="string">"horizental"</span>,</span><br><span class="line">      scrollY: direction === <span class="string">"vertical"</span>,</span><br><span class="line">      probeType: <span class="number">3</span>,</span><br><span class="line">      click: click,</span><br><span class="line">      bounce: &#123;</span><br><span class="line">        top: bounceTop,</span><br><span class="line">        bottom: bounceBottom,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    setBScroll(scroll);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setBScroll(<span class="literal">null</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!bScroll || !onScroll) <span class="keyword">return</span>;</span><br><span class="line">    bScroll.on(<span class="string">"scroll"</span>, onScroll);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      bScroll.off(<span class="string">"scroll"</span>, onScroll);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [onScroll, bScroll]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!bScroll || !pullUp) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> handlePullUp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//判断是否滑动到了底部</span></span><br><span class="line">      <span class="keyword">if</span> (bScroll.y &lt;= bScroll.maxScrollY + <span class="number">100</span>) &#123;</span><br><span class="line">        pullUpDebounce();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    bScroll.on(<span class="string">"scrollEnd"</span>, handlePullUp);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      bScroll.off(<span class="string">"scrollEnd"</span>, handlePullUp);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [pullUp, pullUpDebounce, bScroll]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!bScroll || !pullDown) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> handlePullDown = <span class="function">(<span class="params">pos</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//判断用户的下拉动作</span></span><br><span class="line">      <span class="keyword">if</span> (pos.y &gt; <span class="number">50</span>) &#123;</span><br><span class="line">        pullDownDebounce();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    bScroll.on(<span class="string">"touchEnd"</span>, handlePullDown);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      bScroll.off(<span class="string">"touchEnd"</span>, handlePullDown);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [pullDown, pullDownDebounce, bScroll]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (refresh &amp;&amp; bScroll) &#123;</span><br><span class="line">      bScroll.refresh();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useImperativeHandle(ref, () =&gt; (&#123;</span><br><span class="line">    refresh() &#123;</span><br><span class="line">      <span class="keyword">if</span> (bScroll) &#123;</span><br><span class="line">        bScroll.refresh();</span><br><span class="line">        bScroll.scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getBScroll() &#123;</span><br><span class="line">      <span class="keyword">if</span> (bScroll) &#123;</span><br><span class="line">        <span class="keyword">return</span> bScroll;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">const</span> PullUpdisplayStyle = pullUpLoading</span><br><span class="line">    ? &#123; <span class="attr">display</span>: <span class="string">""</span> &#125;</span><br><span class="line">    : &#123; <span class="attr">display</span>: <span class="string">"none"</span> &#125;;</span><br><span class="line">  <span class="keyword">const</span> PullDowndisplayStyle = pullDownLoading</span><br><span class="line">    ? &#123; <span class="attr">display</span>: <span class="string">""</span> &#125;</span><br><span class="line">    : &#123; <span class="attr">display</span>: <span class="string">"none"</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ScrollContainer ref=&#123;scrollContaninerRef&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">      &#123;<span class="comment">/* 滑到底部加载动画 */</span>&#125;</span><br><span class="line">      &lt;PullUpLoading style=&#123;PullUpdisplayStyle&#125;&gt;</span><br><span class="line">        &lt;Loading&gt;&lt;<span class="regexp">/Loading&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>PullUpLoading&gt;</span><br><span class="line">      &#123;<span class="comment">/* 顶部下拉刷新动画 */</span>&#125;</span><br><span class="line">      &lt;PullDownLoading style=&#123;PullDowndisplayStyle&#125;&gt;</span><br><span class="line">        &lt;Loading2&gt;&lt;<span class="regexp">/Loading2&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>PullDownLoading&gt;</span><br><span class="line">    &lt;<span class="regexp">/ScrollContainer&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp">Scroll.defaultProps = &#123;</span></span><br><span class="line"><span class="regexp">  direction: "vertical",</span></span><br><span class="line"><span class="regexp">  click: true,</span></span><br><span class="line"><span class="regexp">  refresh: true,</span></span><br><span class="line"><span class="regexp">  onScroll: null,</span></span><br><span class="line"><span class="regexp">  pullUpLoading: false,</span></span><br><span class="line"><span class="regexp">  pullDownLoading: false,</span></span><br><span class="line"><span class="regexp">  pullUp: null,</span></span><br><span class="line"><span class="regexp">  pullDown: null,</span></span><br><span class="line"><span class="regexp">  bounceTop: true,</span></span><br><span class="line"><span class="regexp">  bounceBottom: true,</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">Scroll.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  direction: PropTypes.oneOf(["vertical", "horizental"]),</span></span><br><span class="line"><span class="regexp">  refresh: PropTypes.bool,</span></span><br><span class="line"><span class="regexp">  onScroll: PropTypes.func,</span></span><br><span class="line"><span class="regexp">  pullUp: PropTypes.func,</span></span><br><span class="line"><span class="regexp">  pullDown: PropTypes.func,</span></span><br><span class="line"><span class="regexp">  pullUpLoading: PropTypes.bool,</span></span><br><span class="line"><span class="regexp">  pullDownLoading: PropTypes.bool,</span></span><br><span class="line"><span class="regexp">  bounceTop: PropTypes.bool, /</span><span class="regexp">/是否支持向上吸顶</span></span><br><span class="line"><span class="regexp">  bounceBottom: PropTypes.bool, /</span><span class="regexp">/是否支持向下吸顶</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">export default Scroll;</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>这里用到的是<a href="https://github.com/ustbhuangyi/better-scroll/blob/master/README_zh-CN.md" target="_blank" rel="noopener">better-scroll</a>,同样的，因为这里用到了better-scroll，一讲可能就是一篇长篇文章。</p>
<h3 id="21-完成轮播图和scroll"><a href="#21-完成轮播图和scroll" class="headerlink" title="21. 完成轮播图和scroll"></a>21. 完成轮播图和scroll</h3><p>上面的操作都完成了之后，终于要完成轮播和滚动了。</p>
<p>来到recommend下index.js,只要导入scroll然后slider用scroll包裹起来就好了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Scroll <span class="keyword">from</span> <span class="string">'../../baseUI/scroll/index'</span>;</span><br><span class="line">&lt;Scroll className=<span class="string">"list"</span> onScroll=&#123;forceCheck&#125;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Slider bannerList=&#123;bannerListJS&#125;&gt;&lt;<span class="regexp">/Slider&gt;</span></span><br><span class="line"><span class="regexp">      &lt;RecommendList recommendList=&#123;recommendListJS&#125;&gt;&lt;/</span>RecommendList&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Scroll&gt;</span><br></pre></td></tr></table></figure>
<p>现在的效果图如下<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d93a6d672cf4759aaee455f57e1c4f7~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h3 id="22-列表数据api"><a href="#22-列表数据api" class="headerlink" title="22. 列表数据api"></a>22. 列表数据api</h3><p>request.js下增加一条请求 列表数据的方法getRecommendListRequest</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; axiosInstance &#125; <span class="keyword">from</span> <span class="string">"./config"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getBannerRequest = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> axiosInstance.get(<span class="string">"/banner"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRecommendListRequest = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> axiosInstance.get(<span class="string">"/personalized"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="23-列表-redux"><a href="#23-列表-redux" class="headerlink" title="23. 列表 redux"></a>23. 列表 redux</h3><p>接下来轻车熟路，又是像之前写 轮播图 redux一样 写 列表的 redux<br>还是原来的 recommend store下的文件夹<br>constants.js,增加一个常量,用于请求列表数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_BANNER = <span class="string">'home/recommend/CHANGE_BANNER'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_RECOMMEND_LIST = <span class="string">'home/recommend/RECOMMEND_LIST'</span>;</span><br></pre></td></tr></table></figure>

<p>actionCreators.js, 请求列表数据的changeRecommendList，可以异步的getRecommendList</p>
<details style="background:#d0edf5"> 
<summary>actionCreators.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> changeRecommendList = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: actionTypes.CHANGE_RECOMMEND_LIST,</span><br><span class="line">  data: fromJS(data)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRecommendList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    getRecommendListRequest().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(changeRecommendList(data.result));</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"推荐歌单数据传输错误"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<p>reducer.js，增加了另外一个初始化recommenList,以及一个case</p>
<details style="background:#d0edf5"> 
<summary>reducer.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">"./constants"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">"immutable"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState = fromJS(&#123;</span><br><span class="line">  bannerList: [],</span><br><span class="line">  recommendList: [],</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state = defaultState, action) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> actionTypes.CHANGE_BANNER:</span><br><span class="line">      <span class="keyword">return</span> state.set(<span class="string">"bannerList"</span>, action.data);</span><br><span class="line">    <span class="keyword">case</span> actionTypes.CHANGE_RECOMMEND_LIST:</span><br><span class="line">      <span class="keyword">return</span> state.set(<span class="string">"recommendList"</span>, action.data);</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<h3 id="24-收工"><a href="#24-收工" class="headerlink" title="24 . 收工"></a>24 . 收工</h3><p>经历了刀山火海，海枯石烂，来到了最后一步渲染recommendList</p>
<p>recommend 下 index.js, 这里面首先在mapStateToProps和 mapDispatchToProps加上相应的数据，props解构state和action方法，传给RecommendList组件(突然发现这里还有个组件😂)<br>不过这个组件没有什么别的操作，仅仅只是拿到recommend给的数据然后渲染，这个代码就不贴了，三元github上有完整的项目代码</p>
<details style="background:#d0edf5"> 
<summary>index.js</summary>
<pre><code>
    <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">"./store/actionCreators"</span>;</span><br><span class="line"><span class="keyword">import</span> Slider <span class="keyword">from</span> <span class="string">"../../components/slider/"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Content &#125; <span class="keyword">from</span> <span class="string">"./style"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; forceCheck &#125; <span class="keyword">from</span> <span class="string">'react-lazyload'</span>;</span><br><span class="line"><span class="keyword">import</span> Scroll <span class="keyword">from</span> <span class="string">'../../baseUI/scroll/index'</span>;</span><br><span class="line"><span class="keyword">import</span> RecommendList <span class="keyword">from</span> <span class="string">'../../components/list/'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Recommend</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; bannerList, recommendList &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> &#123; getBannerDataDispatch, getRecommendListDataDispatch &#125; = props;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!bannerList.size) &#123;</span><br><span class="line">      getBannerDataDispatch();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!recommendList.size)&#123;</span><br><span class="line">      getRecommendListDataDispatch();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> bannerListJS = bannerList ? bannerList.toJS() : [];</span><br><span class="line">  <span class="keyword">const</span> recommendListJS = recommendList ? recommendList.toJS() :[];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Content&gt;</span><br><span class="line">       &lt;Scroll className=<span class="string">"list"</span> onScroll=&#123;forceCheck&#125;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Slider bannerList=&#123;bannerListJS&#125;&gt;&lt;<span class="regexp">/Slider&gt;</span></span><br><span class="line"><span class="regexp">        &lt;RecommendList recommendList=&#123;recommendListJS&#125;&gt;&lt;/</span>RecommendList&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Scroll&gt;</span><br><span class="line">    &lt;<span class="regexp">/Content&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 映射Redux全局的state到组件的props上</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ recommend bannerList  是对象路径，在recommend.recommendList</span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; (&#123;</span></span><br><span class="line"><span class="regexp">  bannerList: state.getIn(["recommend", "bannerList"]),</span></span><br><span class="line"><span class="regexp">  recommendList: state.getIn(['recommend', 'recommendList']),</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 映射dispatch到props上</span></span><br><span class="line"><span class="regexp">const mapDispatchToProps = (dispatch) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    getBannerDataDispatch() &#123;</span></span><br><span class="line"><span class="regexp">      dispatch(actionTypes.getBannerList());</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    getRecommendListDataDispatch() &#123;</span></span><br><span class="line"><span class="regexp">      dispatch(actionTypes.getRecommendList());</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 将ui组件包装成容器组件</span></span><br><span class="line"><span class="regexp">export default connect(</span></span><br><span class="line"><span class="regexp">  mapStateToProps,</span></span><br><span class="line"><span class="regexp">  mapDispatchToProps</span></span><br><span class="line"><span class="regexp">)(React.memo(Recommend));</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>
最后我们就可以看到了这个效果，上下拉动的过程你会发现，纵享丝滑~

<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93b70da5c77640c8b0eb118573a5628b~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h2 id="25-啦吧啦吧"><a href="#25-啦吧啦吧" class="headerlink" title="25. 啦吧啦吧"></a>25. 啦吧啦吧</h2><p> 相信看到最后的伙伴肯定有所收获，如果对源码感兴趣，这里有 三元项目的<a href="https://github.com/sanyuan0704/react-cloud-music" target="_blank" rel="noopener">github源码</a>,当然，如果想要深入学习这个项目，三元还有个<br> <a href="https://juejin.im/book/6844733816460804104/section/6844733816506941448" target="_blank" rel="noopener">小册</a>。同时，这里还有一个完整的项目演示 <a href="http://47.98.159.95:8010/#/recommend" target="_blank" rel="noopener">地址</a>。</p>
<p> 最后的最后，如果写的不好的地方，欢迎指正，有不清楚的地方也欢迎提问~</p>
]]></content>
      <tags>
        <tag>react</tag>
      </tags>
  </entry>
</search>
